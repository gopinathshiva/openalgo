import{r as l,j as e,a as rs}from"./vendor-react--vsXx8_n.js";import{w as ne,d as Ls,B as A,t as f,e as M}from"./index-DSEDbt0B.js";import{A as Ps,b as Cs,c as Ds,d as Rs,e as Ms,f as Fs,g as As,h as Os}from"./alert-dialog-BEwQJI-D.js";import{C as js,d as fs,a as ks,b as Us}from"./card-DD_S8zKZ.js";import{D as is,b as ls,c as cs,d as os,e as ds,f as xs}from"./dialog-Ok1mp-dr.js";import{S as Z,a as K,b as J,c as ee,d as D}from"./select-CCMMREvp.js";import{C as Ee,b as Se,a as Ie}from"./collapsible-D9aYLJmp.js";import{T as $s,a as Hs,b as ms,c as us}from"./tabs-B_AgdrAy.js";import{S as hs}from"./switch-4LoQOy5g.js";import{L as v}from"./label-e8zaVZub.js";import{I as P}from"./input-v3xQNtiF.js";import{T as se,a as te,b as F,c,d as ae,e as o}from"./table-D6NMfRJ_.js";import{t as Ys}from"./trading-BUBdJb38.js";import{u as Gs}from"./useLivePrice-BipKz8ez.js";import{V as ps,a1 as Te,m as we,aj as qs,c as Bs,a2 as Xs,aZ as Le}from"./vendor-icons-C4mfU7kN.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-CiBIGs7t.js";import"./vendor-radix-CodNzUU3.js";import"./useMarketData-BkCpnkL6.js";async function zs(){const t=await ne.get("/api/strategy-state");if(t.data.status==="error")throw new Error(t.data.message||"Failed to fetch strategy states");return t.data.data}async function Ws(t){const r=await ne.delete(`/api/strategy-state/${encodeURIComponent(t)}`);if(r.data.status==="error")throw new Error(r.data.message||"Failed to delete strategy state")}async function Vs(t,r,x,h){const u=await ne.post(`/api/strategy-state/${encodeURIComponent(t)}/override`,{leg_key:r,override_type:x,new_value:h});if(u.data.status==="error")throw new Error(u.data.message||"Failed to create strategy override");return{message:u.data.message||"Override created successfully"}}async function Qs(t,r){try{const x=await ne.post(`/api/strategy-state/${encodeURIComponent(t)}/manual-leg`,r);if(x.data.status==="error")throw new Error(x.data.message||"Failed to add manual position");return{message:x.data.message||"Manual position added successfully"}}catch(x){if(x&&typeof x=="object"&&"response"in x){const u=x.response?.data?.message;if(u)throw new Error(u)}throw x}}async function Zs(t,r,x,h){try{const u=await ne.post(`/api/strategy-state/${encodeURIComponent(t)}/leg/${encodeURIComponent(r)}/manual-exit`,{exit_price:x,exit_status:h});if(u.data.status==="error")throw new Error(u.data.message||"Failed to exit position");return{message:u.data.message||"Position exited successfully"}}catch(u){if(u&&typeof u=="object"&&"response"in u){const E=u.response?.data?.message;if(E)throw new Error(E)}throw u}}const Ks={RUNNING:"bg-green-500",PAUSED:"bg-yellow-500",COMPLETED:"bg-gray-400",ERROR:"bg-red-500"},me={IDLE:"bg-gray-400",PENDING_ENTRY:"bg-blue-400",IN_POSITION:"bg-green-500",PENDING_EXIT:"bg-orange-400",EXITED_WAITING_REENTRY:"bg-yellow-500",EXITED_WAITING_REEXECUTE:"bg-purple-500",DONE:"bg-gray-500"},Js={SL_HIT:"bg-red-500",TARGET_HIT:"bg-green-500",HEDGE_SL_EXIT:"bg-red-400",HEDGE_TARGET_EXIT:"bg-green-400",STRATEGY_DONE:"bg-gray-500"};function et(t){if(t==null)return"â€”";const r=new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2,maximumFractionDigits:2}).format(Math.abs(t));return t<0?`-${r}`:r}function L(t){return t==null?"â€”":t.toFixed(2)}function st(t){if(t.wait_trigger_price)return t.wait_trigger_price;const r=t.wait_baseline_price,x=t.wait_trade_percent;return r==null||x==null||!t.side?null:t.side==="BUY"?r*(1+x):t.side==="SELL"?r*(1-x):null}function tt(t){return t?new Date(t).toLocaleString("en-IN",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kolkata"}):"â€”"}function Pe(t){if(!t)return"â€”";const r=new Date(t),x=new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),h=new Date(x.getFullYear(),x.getMonth(),x.getDate()),u=new Date(r.toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),S=new Date(u.getFullYear(),u.getMonth(),u.getDate());return h.getTime()===S.getTime()?r.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kolkata"}):r.toLocaleString("en-IN",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kolkata"})}function U({value:t,showIcon:r=!0}){if(t==null)return e.jsx("span",{className:"text-muted-foreground",children:"-"});const x=t>=0,h=x?"text-green-600":"text-red-600";return e.jsxs("span",{className:`font-medium ${h} flex items-center gap-1`,children:[r&&(x?e.jsx(Bs,{className:"h-3 w-3"}):e.jsx(Xs,{className:"h-3 w-3"})),et(t)]})}function Ce(t,r){const x=t.entry_price,h=t.quantity,u=t.side;return r==null||x==null||h===null||h===void 0||!u?null:u==="BUY"?(r-x)*h:u==="SELL"?(x-r)*h:null}function at(t){return!t||t.length===0?0:t.reduce((r,x)=>r+(x.pnl||0),0)}function gs({value:t,instanceId:r,legKey:x,overrideType:h,leg:u,onSuccess:S}){const[E,T]=l.useState(!1),[I,p]=l.useState(""),[a,O]=l.useState(!1),i=rs.useRef(null),R=u.status==="IN_POSITION",k=()=>{R&&(p(t?.toString()??""),T(!0))};rs.useEffect(()=>{E&&i.current&&(i.current.focus(),i.current.select())},[E]);const Y=d=>{if(Number.isNaN(d)||d<0)return"Value must be a non-negative number";const N=u.entry_price;if(!N)return null;const y=u.side;if(h==="sl_price"){if(y==="SELL"&&d<=N)return`SL for SELL must be above entry price (${N.toFixed(2)})`;if(y==="BUY"&&d>=N)return`SL for BUY must be below entry price (${N.toFixed(2)})`}if(h==="target_price"){if(y==="SELL"&&d>=N)return`Target for SELL must be below entry price (${N.toFixed(2)})`;if(y==="BUY"&&d<=N)return`Target for BUY must be above entry price (${N.toFixed(2)})`}return null},$=async()=>{const d=Number.parseFloat(I),N=Y(d);if(N){f.error(N);return}if(t!=null&&Math.abs(d-t)<.01){T(!1);return}O(!0);try{const y=await Vs(r,x,h,d);f.success(y.message),T(!1),S()}catch(y){f.error(y instanceof Error?y.message:"Failed to update")}finally{O(!1)}},G=d=>{d.key==="Enter"?(d.preventDefault(),$()):d.key==="Escape"&&T(!1)},m=()=>{T(!1)};return E?e.jsx(P,{ref:i,type:"number",step:"0.05",value:I,onChange:d=>p(d.target.value),onKeyDown:G,onBlur:m,disabled:a,className:"h-7 w-20 text-right text-sm px-1"}):e.jsx("span",{onClick:k,onKeyDown:d=>d.key==="Enter"&&k(),tabIndex:R?0:void 0,role:R?"button":void 0,className:R?"cursor-pointer hover:bg-muted px-1 py-0.5 rounded transition-colors":"",title:R?"Click to edit":void 0,children:L(t)})}function nt({legs:t,instanceId:r,onRefresh:x,liveLtpByLegKey:h,onExitLeg:u}){if(!t)return e.jsx("p",{className:"text-muted-foreground text-sm py-4",children:"No positions found"});const S=Object.entries(t),E=S.filter(([p,a])=>["IN_POSITION","PENDING_EXIT"].includes(a.status)),T=S.filter(([p,a])=>["IDLE","PENDING_ENTRY","EXITED_WAITING_REENTRY","EXITED_WAITING_REEXECUTE"].includes(a.status)),I=S.filter(([p,a])=>a.status==="DONE");return S.length===0?e.jsx("p",{className:"text-muted-foreground text-sm py-4",children:"No positions found"}):e.jsxs("div",{className:"space-y-4",children:[E.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-green-500"}),"Open Positions (",E.length,")"]}),e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(F,{children:[e.jsx(c,{children:"Leg"}),e.jsx(c,{children:"Symbol"}),e.jsx(c,{children:"Side"}),e.jsx(c,{className:"text-right",children:"Qty"}),e.jsx(c,{className:"text-right",children:"Entry"}),e.jsx(c,{className:"text-right",children:"LTP"}),e.jsx(c,{className:"text-right",children:"SL"}),e.jsx(c,{className:"text-right",children:"Target"}),e.jsx(c,{children:"Status"}),e.jsx(c,{className:"text-right",children:"Unreal P&L"}),e.jsx(c,{className:"text-right",children:"Reentry"}),e.jsx(c,{className:"text-center",children:"Action"})]})}),e.jsx(ae,{children:E.map(([p,a])=>e.jsxs(F,{children:[e.jsx(o,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:a.leg_pair_name||p}),a.is_main_leg&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Main"})]})}),e.jsx(o,{className:"font-mono text-xs",children:a.symbol}),e.jsx(o,{children:a.side?e.jsx(M,{variant:a.side==="SELL"?"destructive":"default",children:a.side}):e.jsx("span",{className:"text-muted-foreground",children:"â€”"})}),e.jsx(o,{className:"text-right",children:a.quantity}),e.jsx(o,{className:"text-right",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:L(a.entry_price)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Pe(a.entry_time)})]})}),e.jsx(o,{className:"text-right",children:h?.[p]===null||h?.[p]===void 0?"-":L(h?.[p])}),e.jsx(o,{className:"text-right",children:e.jsx(gs,{value:a.sl_price,instanceId:r,legKey:p,overrideType:"sl_price",leg:a,onSuccess:x})}),e.jsx(o,{className:"text-right",children:e.jsx(gs,{value:a.target_price,instanceId:r,legKey:p,overrideType:"target_price",leg:a,onSuccess:x})}),e.jsx(o,{children:e.jsx(M,{className:me[a.status],variant:"secondary",children:a.status.replace(/_/g," ")})}),e.jsx(o,{className:"text-right",children:e.jsx(U,{value:Ce(a,h?.[p])})}),e.jsx(o,{className:"text-right",children:a.reentry_limit===null||a.reentry_limit===void 0?"-":`${a.reentry_count??0}/${a.reentry_limit}`}),e.jsx(o,{className:"text-center",children:a.status==="IN_POSITION"&&e.jsx(A,{variant:"outline",size:"sm",onClick:()=>u(p,a),className:"h-7 px-2 text-xs",children:"Exit"})})]},p))})]})})]}),T.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-yellow-500"}),"Pending / Planned Trades (",T.length,")"]}),e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(F,{children:[e.jsx(c,{children:"Leg"}),e.jsx(c,{children:"Symbol"}),e.jsx(c,{children:"Side"}),e.jsx(c,{className:"text-right",children:"Qty"}),e.jsx(c,{className:"text-right",children:"LTP"}),e.jsx(c,{className:"text-right",children:"Planned Entry"}),e.jsx(c,{className:"text-right",children:"Planned SL"}),e.jsx(c,{className:"text-right",children:"Planned Target"}),e.jsx(c,{children:"Status"}),e.jsx(c,{className:"text-right",children:"Reentry"}),e.jsx(c,{className:"text-right",children:"Reexec"})]})}),e.jsx(ae,{children:T.map(([p,a])=>e.jsxs(F,{children:[e.jsx(o,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:a.leg_pair_name||p}),a.is_main_leg&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Main"})]})}),e.jsx(o,{className:"font-mono text-xs",children:a.symbol}),e.jsx(o,{children:a.side?e.jsx(M,{variant:a.side==="SELL"?"destructive":"default",children:a.side}):e.jsx("span",{className:"text-muted-foreground",children:"â€”"})}),e.jsx(o,{className:"text-right",children:a.quantity}),e.jsx(o,{className:"text-right",children:h?.[p]===null||h?.[p]===void 0?"-":L(h?.[p])}),e.jsx(o,{className:"text-right",children:L(st(a))}),e.jsx(o,{className:"text-right",children:L(a.sl_price)}),e.jsx(o,{className:"text-right",children:L(a.target_price)}),e.jsx(o,{children:e.jsx(M,{className:me[a.status]||"bg-gray-400",variant:"secondary",children:a.status.replace(/_/g," ")})}),e.jsx(o,{className:"text-right",children:a.reentry_limit===null||a.reentry_limit===void 0?"-":`${a.reentry_count??0}/${a.reentry_limit}`}),e.jsx(o,{className:"text-right",children:a.reexecute_limit===null||a.reexecute_limit===void 0?"-":`${a.reexecute_count??0}/${a.reexecute_limit}`})]},p))})]})})]}),I.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-gray-500"}),"Done Legs (",I.length,")"]}),e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(F,{children:[e.jsx(c,{children:"Leg"}),e.jsx(c,{children:"Symbol"}),e.jsx(c,{children:"Side"}),e.jsx(c,{className:"text-right",children:"Qty"}),e.jsx(c,{className:"text-right",children:"Total P&L"}),e.jsx(c,{children:"Status"})]})}),e.jsx(ae,{children:I.map(([p,a])=>e.jsxs(F,{children:[e.jsx(o,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:a.leg_pair_name||p}),a.is_main_leg&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Main"})]})}),e.jsx(o,{className:"font-mono text-xs",children:a.symbol}),e.jsx(o,{children:a.side?e.jsx(M,{variant:a.side==="SELL"?"destructive":"default",children:a.side}):e.jsx("span",{className:"text-muted-foreground",children:"â€”"})}),e.jsx(o,{className:"text-right",children:a.quantity}),e.jsx(o,{className:"text-right",children:e.jsx("div",{className:"flex justify-end",children:e.jsx(U,{value:a.total_pnl??a.realized_pnl})})}),e.jsx(o,{children:e.jsx(M,{className:me[a.status]||"bg-gray-400",variant:"secondary",children:a.status.replace(/_/g," ")})})]},p))})]})})]})]})}function rt({trades:t}){return!t||t.length===0?e.jsx("p",{className:"text-muted-foreground text-sm py-4",children:"No trade history"}):e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsx("div",{className:"max-h-[50vh] overflow-y-auto",children:e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(F,{children:[e.jsx(c,{children:"#"}),e.jsx(c,{children:"Leg"}),e.jsx(c,{children:"Symbol"}),e.jsx(c,{children:"Side"}),e.jsx(c,{className:"text-right",children:"Qty"}),e.jsx(c,{className:"text-right",children:"Entry"}),e.jsx(c,{className:"text-right",children:"Exit"}),e.jsx(c,{className:"text-right",children:"SL"}),e.jsx(c,{className:"text-right",children:"Target"}),e.jsx(c,{children:"Exit Type"}),e.jsx(c,{className:"text-right",children:"P&L"})]})}),e.jsx(ae,{children:t.map(r=>e.jsxs(F,{children:[e.jsx(o,{children:r.trade_id}),e.jsx(o,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:r.leg_pair_name||r.leg_key}),r.is_main_leg&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Main"})]})}),e.jsx(o,{className:"font-mono text-xs",children:r.symbol}),e.jsx(o,{children:e.jsx(M,{variant:r.side==="SELL"?"destructive":"default",children:r.side})}),e.jsx(o,{className:"text-right",children:r.quantity}),e.jsx(o,{className:"text-right",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:L(r.entry_price)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Pe(r.entry_time)})]})}),e.jsx(o,{className:"text-right",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:L(r.exit_price)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Pe(r.exit_time)})]})}),e.jsx(o,{className:"text-right",children:L(r.sl_price)}),e.jsx(o,{className:"text-right",children:L(r.target_price)}),e.jsx(o,{children:r.exit_type&&e.jsx(M,{className:Js[r.exit_type],variant:"secondary",children:r.exit_type.replace(/_/g," ")})}),e.jsx(o,{className:"text-right",children:e.jsx(U,{value:r.pnl})})]},r.trade_id))})]})})})}function it({strategy:t,onDelete:r,onRefresh:x,liveLtpByLegKey:h,onAddManualLeg:u,onExitLeg:S}){const[E,T]=l.useState(!0),[I,p]=l.useState(!1),[a,O]=l.useState(!1),i=t.config,R=m=>{m.stopPropagation(),r(t.instance_id,t.strategy_name)},k=t.legs||{},Y=l.useMemo(()=>at(t.trade_history),[t.trade_history]),$=l.useMemo(()=>{let m=0;for(const[d,N]of Object.entries(k)){if(!["IN_POSITION","PENDING_EXIT"].includes(N.status))continue;const y=Ce(N,h?.[d]);y!==null&&(m+=y)}return m},[k,h]),G=Y+$;return e.jsx(Ee,{open:E,onOpenChange:T,children:e.jsxs(js,{className:"mb-4",children:[e.jsx(Se,{asChild:!0,children:e.jsx(ks,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[E?e.jsx(Te,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(we,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx(Us,{className:"text-lg",children:t.strategy_name}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[i&&e.jsxs(e.Fragment,{children:[i.underlying," | Expiry: ",i.expiry_date," | Lots: ",i.lots," Ã— ",i.lot_size]}),!i&&`Instance: ${t.instance_id}`]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total P&L"}),e.jsx(U,{value:G})]}),e.jsx(M,{className:Ks[t.status]||"bg-gray-400",children:t.status}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:m=>{m.stopPropagation(),u(t)},children:"Add Position"}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:R,title:"Delete strategy state",children:e.jsx(qs,{className:"h-4 w-4"})})]})]})]})})}),e.jsx(Ie,{children:e.jsxs(fs,{className:"pt-0 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Open Positions"}),e.jsx("p",{className:"text-lg font-semibold",children:Object.values(t.legs||{}).filter(m=>["IN_POSITION","PENDING_EXIT"].includes(m.status)).length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pending / Planned"}),e.jsx("p",{className:"text-lg font-semibold",children:Object.values(t.legs||{}).filter(m=>["IDLE","PENDING_ENTRY","EXITED_WAITING_REENTRY","EXITED_WAITING_REEXECUTE"].includes(m.status)).length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Trades"}),e.jsx("p",{className:"text-lg font-semibold",children:t.trade_history?.length??0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Realized P&L"}),e.jsx(U,{value:Y,showIcon:!1})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Unrealized P&L"}),e.jsx(U,{value:$,showIcon:!1})]})]}),i&&e.jsxs(Ee,{open:a,onOpenChange:O,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-md font-semibold",children:"Strategy Configuration"}),e.jsx(Se,{asChild:!0,children:e.jsxs(A,{variant:"ghost",size:"sm",className:"h-8 px-2",children:[a?e.jsx(Te,{className:"h-4 w-4 mr-2"}):e.jsx(we,{className:"h-4 w-4 mr-2"}),a?"Hide":"Show"]})})]}),e.jsx(Ie,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 text-sm border rounded-md p-4 bg-muted/20",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-semibold text-xs uppercase text-muted-foreground",children:"Basic Settings"}),i.underlying&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Underlying:"})," ",e.jsx("span",{className:"font-medium",children:i.underlying})]}),i.expiry_date&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Expiry:"})," ",e.jsx("span",{className:"font-medium",children:i.expiry_date})]}),i.lots!==void 0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Lots:"})," ",e.jsx("span",{className:"font-medium",children:i.lots})]}),i.lot_size!==void 0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Lot Size:"})," ",e.jsx("span",{className:"font-medium",children:i.lot_size})]}),i.quantity!==void 0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Quantity:"})," ",e.jsx("span",{className:"font-medium",children:i.quantity})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-semibold text-xs uppercase text-muted-foreground",children:"Execution"}),i.exchange&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Exchange:"})," ",e.jsx("span",{className:"font-medium",children:i.exchange})]}),i.product&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Product:"})," ",e.jsx("span",{className:"font-medium",children:i.product})]}),i.price_type&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Price Type:"})," ",e.jsx("span",{className:"font-medium",children:i.price_type})]}),i.poll_interval!==void 0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Poll Interval:"})," ",e.jsxs("span",{className:"font-medium",children:[i.poll_interval,"s"]})]}),i.entry_time&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Entry Time:"})," ",e.jsx("span",{className:"font-medium",children:i.entry_time})]}),i.exit_time&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Exit Time:"})," ",e.jsx("span",{className:"font-medium",children:i.exit_time})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-semibold text-xs uppercase text-muted-foreground",children:"Risk Management"}),i.sl_percent!==void 0&&i.sl_percent!==null&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"SL %:"})," ",e.jsxs("span",{className:"font-medium",children:[(i.sl_percent*100).toFixed(1),"%"]})]}),i.target_percent!==void 0&&i.target_percent!==null&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Target %:"})," ",e.jsxs("span",{className:"font-medium",children:[(i.target_percent*100).toFixed(1),"%"]})]}),i.reentry_limit!==void 0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Re-entry Limit:"})," ",e.jsx("span",{className:"font-medium",children:i.reentry_limit})]}),i.reexecute_limit!==void 0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Re-execute Limit:"})," ",e.jsx("span",{className:"font-medium",children:i.reexecute_limit})]})]}),i.leg_pair_configs&&i.leg_pair_configs.length>0&&e.jsxs("div",{className:"space-y-2 md:col-span-2 lg:col-span-3",children:[e.jsx("p",{className:"font-semibold text-xs uppercase text-muted-foreground",children:"Leg Configurations"}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:i.leg_pair_configs.map((m,d)=>e.jsxs("div",{className:"border rounded p-3 bg-background/50",children:[e.jsx("p",{className:"font-medium mb-2",children:m.name||`Leg ${d+1}`}),e.jsxs("div",{className:"space-y-1 text-xs",children:[m.main_leg&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Main Leg:"})," ",e.jsx("span",{className:"font-medium",children:m.main_leg})]}),m.sl_percent!==void 0&&m.sl_percent!==null&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"SL %:"})," ",e.jsxs("span",{className:"font-medium",children:[(m.sl_percent*100).toFixed(1),"%"]})]}),m.target_percent!==void 0&&m.target_percent!==null&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Target %:"})," ",e.jsxs("span",{className:"font-medium",children:[(m.target_percent*100).toFixed(1),"%"]})]}),m.reentry_limit!==void 0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Re-entry:"})," ",e.jsx("span",{className:"font-medium",children:m.reentry_limit})]}),m.reexecute_limit!==void 0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Re-execute:"})," ",e.jsx("span",{className:"font-medium",children:m.reexecute_limit})]}),m.ce_sell_offset&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"CE Sell:"})," ",e.jsx("span",{className:"font-medium",children:m.ce_sell_offset})]}),m.pe_sell_offset&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"PE Sell:"})," ",e.jsx("span",{className:"font-medium",children:m.pe_sell_offset})]})]})]},d))})]})]})})]}),e.jsxs(Ee,{open:I,onOpenChange:p,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-md font-semibold",children:"Leg P&L"}),e.jsx(Se,{asChild:!0,children:e.jsxs(A,{variant:"ghost",size:"sm",className:"h-8 px-2",children:[I?e.jsx(Te,{className:"h-4 w-4 mr-2"}):e.jsx(we,{className:"h-4 w-4 mr-2"}),I?"Hide":"Show"]})})]}),e.jsx(Ie,{children:e.jsx("div",{className:"rounded-md border overflow-x-auto mt-2",children:e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(F,{children:[e.jsx(c,{children:"Leg"}),e.jsx(c,{children:"Symbol"}),e.jsx(c,{children:"Status"}),e.jsx(c,{className:"text-right",children:"Realized P&L"}),e.jsx(c,{className:"text-right",children:"Unrealized P&L"}),e.jsx(c,{className:"text-right",children:"Total P&L"})]})}),e.jsx(ae,{children:Object.entries(k).map(([m,d])=>{const N=["IN_POSITION","PENDING_EXIT"].includes(d.status)?Ce(d,h?.[m]):0,y=d.realized_pnl??0,re=(d.total_pnl??null)!==null&&d.total_pnl!==void 0?d.total_pnl:N===null?null:y+N;return e.jsxs(F,{children:[e.jsx(o,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:d.leg_pair_name||m}),d.is_main_leg&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Main"})]})}),e.jsx(o,{className:"font-mono text-xs",children:d.symbol}),e.jsx(o,{children:e.jsx(M,{className:me[d.status]||"bg-gray-400",variant:"secondary",children:d.status.replace(/_/g," ")})}),e.jsx(o,{className:"text-right",children:e.jsx(U,{value:d.realized_pnl,showIcon:!1})}),e.jsx(o,{className:"text-right",children:e.jsx(U,{value:N,showIcon:!1})}),e.jsx(o,{className:"text-right",children:e.jsx(U,{value:re,showIcon:!1})})]},m)})})]})})})]}),t.last_updated&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last updated: ",tt(t.last_updated),t.orchestrator&&` | Cycles: ${t.orchestrator.cycle_count}`]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold mb-3",children:"ðŸ“Š Current Positions"}),e.jsx(nt,{legs:t.legs,instanceId:t.instance_id,onRefresh:x,liveLtpByLegKey:h,onExitLeg:(m,d)=>S(t.instance_id,m,d)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold mb-3",children:"ðŸ“œ Trade History"}),e.jsx(rt,{trades:t.trade_history})]})]})})]})})}function It(){const[t,r]=l.useState([]),[x,h]=l.useState(!0),[u,S]=l.useState(!1),{apiKey:E}=Ls(),[T,I]=l.useState(!1),[p,a]=l.useState(null),[O,i]=l.useState([]),[R,k]=l.useState(!1),[Y,$]=l.useState(null),[G,m]=l.useState(""),[d,N]=l.useState(""),[y,re]=l.useState(!0),[ue,De]=l.useState(""),[he,Re]=l.useState(""),[pe,Me]=l.useState(""),[ge,Fe]=l.useState(""),[Ae,je]=l.useState(!1),[ie,Oe]=l.useState("TRACK"),[fe,ke]=l.useState(""),[Ue,Ns]=l.useState("NFO"),[$e,He]=l.useState("NRML"),[Ye,Ge]=l.useState(""),[qe,Be]=l.useState("SELL"),[Ne,Xe]=l.useState(""),[ye,ze]=l.useState(""),We="strategy_positions_auto_refresh_enabled",Ve="strategy_positions_auto_refresh_seconds",[q,Qe]=l.useState(!0),[z,Ze]=l.useState(10),le=l.useRef(!1),[H,_e]=l.useState({open:!1,instanceId:"",strategyName:""}),[W,Ke]=l.useState(!1),[Je,ce]=l.useState(""),[w,oe]=l.useState({open:!1,instanceId:"",legKey:"",leg:null}),[ve,de]=l.useState(""),[xe,be]=l.useState("SL_HIT"),[B,es]=l.useState(!1),X=async(s=!1)=>{try{const n=await zs();r(n),s&&f.success("Data refreshed")}catch(n){console.error("Error fetching strategy states:",n),f.error("Failed to fetch strategy positions")}finally{h(!1),S(!1),le.current=!1}},ys=(s,n)=>{ce(""),_e({open:!0,instanceId:s,strategyName:n})},_s=async()=>{if(H.instanceId){Ke(!0);try{await Ws(H.instanceId),f.success(`Strategy "${H.strategyName}" deleted successfully`),r(s=>s.filter(n=>n.instance_id!==H.instanceId))}catch(s){console.error("Error deleting strategy:",s),f.error("Failed to delete strategy")}finally{Ke(!1),_e({open:!1,instanceId:"",strategyName:""}),ce("")}}},vs=Je===H.strategyName,bs=(s,n,j)=>{oe({open:!0,instanceId:s,legKey:n,leg:j}),de(""),be("SL_HIT")},Es=async()=>{if(!w.instanceId||!w.legKey||!w.leg)return;const s=parseFloat(ve);if(isNaN(s)||s<=0){f.error("Please enter a valid exit price");return}const n=w.leg.entry_price,j=w.leg.side;if(n&&j){if(xe==="TARGET_HIT"){if(j==="BUY"&&s<=n){f.error(`For BUY positions with TARGET_HIT, exit price must be greater than entry price (${n.toFixed(2)})`);return}if(j==="SELL"&&s>=n){f.error(`For SELL positions with TARGET_HIT, exit price must be less than entry price (${n.toFixed(2)})`);return}}else if(xe==="SL_HIT"){if(j==="BUY"&&s>=n){f.error(`For BUY positions with SL_HIT, exit price must be less than entry price (${n.toFixed(2)})`);return}if(j==="SELL"&&s<=n){f.error(`For SELL positions with SL_HIT, exit price must be greater than entry price (${n.toFixed(2)})`);return}}}es(!0);try{const _=await Zs(w.instanceId,w.legKey,s,xe);f.success(_.message),oe({open:!1,instanceId:"",legKey:"",leg:null}),de(""),X(!1)}catch(_){console.error("Error exiting position:",_),f.error(_ instanceof Error?_.message:"Failed to exit position")}finally{es(!1)}};l.useEffect(()=>{try{const s=window.localStorage.getItem(We);s!==null&&Qe(s==="1"||s==="true");const n=window.localStorage.getItem(Ve);if(n){const j=Number.parseInt(n,10);if(!Number.isNaN(j)){const _=Math.min(300,Math.max(5,j));Ze(_)}}}catch(s){console.error("Error loading strategy positions auto-refresh preferences:",s)}X()},[]),l.useEffect(()=>{try{window.localStorage.setItem(We,q?"1":"0"),window.localStorage.setItem(Ve,String(z))}catch(s){console.error("Error saving strategy positions auto-refresh preferences:",s)}},[q,z]),l.useEffect(()=>{if(!q)return;const s=Math.min(300,Math.max(5,z)),n=window.setInterval(()=>{le.current||(le.current=!0,S(!0),X(!1))},s*1e3);return()=>window.clearInterval(n)},[q,z]);const ss=l.useMemo(()=>{const s=[];for(const n of t){const j=n.config?.exchange||"NFO",_=n.legs||{};for(const[C,g]of Object.entries(_)){if(!["IN_POSITION","PENDING_EXIT","PENDING_ENTRY","IDLE","EXITED_WAITING_REENTRY","EXITED_WAITING_REEXECUTE"].includes(g.status))continue;const b=(g.symbol||"").trim();if(b)if(b.includes(":")){const[V,Q]=b.split(":",2);if(!Q)continue;s.push({instanceId:n.instance_id,legKey:C,symbol:Q,exchange:V||j,ltp:g.current_ltp??g.entry_price})}else s.push({instanceId:n.instance_id,legKey:C,symbol:b,exchange:j,ltp:g.current_ltp??g.entry_price})}}return s},[t]),{data:ts}=Gs(ss,{enabled:ss.length>0,useMultiQuotesFallback:!0}),Ss=l.useMemo(()=>{const s={};for(const n of ts)s[n.instanceId]||(s[n.instanceId]={}),s[n.instanceId][n.legKey]=n.ltp;return s},[ts]),Is=()=>{le.current=!0,S(!0),X(!0)},as=()=>{i([]),m(""),N(""),re(!0),De(""),Re(""),Me(""),Fe(""),$(null),je(!1),Oe("TRACK"),ke(""),Ge(""),Xe(""),ze(""),Be("SELL"),He("NRML")},Ts=async s=>{if(!E){f.error("API key not available");return}a(s),I(!0),k(!0),$(null);try{const n=await Ys.getPositions(E);if(n.status!=="success"||!n.data)throw new Error(n.message||"Failed to load positions");const j=n.data.filter(_=>_.quantity!==0);i(j),j.length===0&&m("")}catch(n){$(n instanceof Error?n.message:"Failed to load positions")}finally{k(!1)}},ws=async()=>{if(!p)return;const s=ue.trim()===""?null:Number.parseFloat(ue),n=he.trim()===""?null:Number.parseFloat(he),j=pe.trim()===""?null:Number.parseInt(pe,10),_=ge.trim()===""?null:Number.parseInt(ge,10);if(s!==null&&(Number.isNaN(s)||s<=0)){f.error("SL percent must be a positive number");return}if(n!==null&&(Number.isNaN(n)||n<=0)){f.error("Target percent must be a positive number");return}if(j!==null&&(Number.isNaN(j)||j<0)){f.error("Re-entry limit must be a non-negative number");return}if(_!==null&&(Number.isNaN(_)||_<0)){f.error("Re-execute limit must be a non-negative number");return}if(!y&&d.trim()){const g=d.trim(),b=p;if(!(b?.legs&&Object.values(b.legs).some(Q=>Q.leg_pair_name===g&&Q.is_main_leg===!0))){f.error(`Leg Pair '${g}' must have at least one Main Leg trade. Please mark this as Main Leg or add a Main Leg trade first.`);return}}let C={leg_key:`MANUAL_${Date.now()}`,sl_percent:s,target_percent:n,leg_pair_name:d.trim()?d.trim():null,reentry_limit:j,reexecute_limit:_,mode:ie};if(ie==="TRACK"){const g=O.find(b=>`${b.exchange}:${b.symbol}:${b.product}:${b.quantity}`===G);if(!g){f.error("Select a position");return}C={...C,symbol:g.symbol,exchange:g.exchange,product:g.product,quantity:Math.abs(g.quantity),side:g.quantity>0?"BUY":"SELL",entry_price:g.average_price,is_main_leg:y}}else{if(!fe.trim()){f.error("Symbol is required");return}const g=parseInt(Ye);if(isNaN(g)||g<=0){f.error("Invalid quantity");return}const b=Ne.trim()?parseFloat(Ne):null,V=ye.trim()?parseFloat(ye):null;if(b!==null&&(isNaN(b)||b<=0)){f.error("Invalid wait percentage");return}if(b!==null&&V===null){f.error("Baseline price is required for Wait Entry");return}C={...C,symbol:fe.toUpperCase(),exchange:Ue,product:$e,quantity:g,side:qe,is_main_leg:y,wait_trade_percent:b,wait_baseline_price:V}}je(!0);try{const g=await Qs(p.instance_id,C);f.success(g.message),I(!1),as(),X(!1)}catch(g){f.error(g instanceof Error?g.message:"Failed to add manual position")}finally{je(!1)}},ns=l.useMemo(()=>[...t].sort((s,n)=>{const j=(s.strategy_name||"").toLocaleLowerCase(),_=(n.strategy_name||"").toLocaleLowerCase();if(j<_)return-1;if(j>_)return 1;const C=s.created_at?new Date(s.created_at).getTime():Number.POSITIVE_INFINITY,g=n.created_at?new Date(n.created_at).getTime():Number.POSITIVE_INFINITY;return C!==g?C-g:(s.instance_id||"").localeCompare(n.instance_id||"")}),[t]);return e.jsxs("div",{className:"container mx-auto py-6 px-4 max-w-7xl",children:[e.jsx("div",{className:"sticky top-[56px] z-10 bg-background pb-6 mb-6 border-b",children:e.jsxs("div",{className:"flex items-start justify-between gap-4 pt-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Strategy Positions"}),e.jsx("p",{className:"text-muted-foreground",children:"View positions and trade history for Python strategies"})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"text-xs text-muted-foreground",children:"Auto refresh"}),e.jsx(hs,{checked:q,onCheckedChange:Qe})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"text-xs text-muted-foreground",children:"Every (s)"}),e.jsx(P,{type:"number",min:5,max:300,step:1,value:z,onChange:s=>{const n=Number.parseInt(s.target.value,10);if(Number.isNaN(n))return;const j=Math.min(300,Math.max(5,n));Ze(j)},className:"h-8 w-20",disabled:!q})]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:Is,disabled:u,children:[e.jsx(ps,{className:`h-4 w-4 mr-2 ${u?"animate-spin":""}`}),"Refresh"]})]}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Range: 5â€“300 seconds (saved locally)"})]})]})}),x?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ps,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):ns.length===0?e.jsx(js,{children:e.jsxs(fs,{className:"py-12 text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:"No strategy states found"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Strategy positions will appear here when you run Python strategies with state persistence."})]})}):e.jsx("div",{children:ns.map(s=>e.jsx(it,{strategy:s,onDelete:ys,onRefresh:()=>X(!1),liveLtpByLegKey:Ss[s.instance_id]||{},onAddManualLeg:Ts,onExitLeg:bs},s.instance_id))}),e.jsx(is,{open:T,onOpenChange:s=>{I(s),s||(as(),a(null))},children:e.jsxs(ls,{className:"sm:max-w-xl",children:[e.jsxs(cs,{children:[e.jsx(os,{children:"Add Position to Strategy"}),e.jsxs(ds,{children:["Select a live broker position to track in ",p?.strategy_name||"this strategy","."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs($s,{value:ie,onValueChange:s=>Oe(s),children:[e.jsxs(Hs,{className:"grid w-full grid-cols-2",children:[e.jsx(ms,{value:"TRACK",children:"Track Existing"}),e.jsx(ms,{value:"NEW",children:"New Trade"})]}),e.jsx(us,{value:"TRACK",className:"pt-4 space-y-4",children:R?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading positions..."}):Y?e.jsx("p",{className:"text-sm text-destructive",children:Y}):O.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No open positions available."}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Position"}),e.jsxs(Z,{value:G,onValueChange:m,children:[e.jsx(K,{children:e.jsx(J,{placeholder:"Select position"})}),e.jsx(ee,{children:O.map(s=>{const n=`${s.exchange}:${s.symbol}:${s.product}:${s.quantity}`,j=s.quantity>0?"BUY":"SELL";return e.jsxs(D,{value:n,children:[s.exchange,":",s.symbol," â€¢ ",j," ",Math.abs(s.quantity)," @ ",L(s.average_price)]},n)})})]})]})}),e.jsxs(us,{value:"NEW",className:"pt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Symbol"}),e.jsx(P,{placeholder:"e.g. SENSEX24FEB75000PE",value:fe,onChange:s=>ke(s.target.value.toUpperCase())})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Exchange"}),e.jsxs(Z,{value:Ue,onValueChange:Ns,children:[e.jsx(K,{children:e.jsx(J,{})}),e.jsxs(ee,{children:[e.jsx(D,{value:"NFO",children:"NFO"}),e.jsx(D,{value:"BFO",children:"BFO"}),e.jsx(D,{value:"MCX",children:"MCX"}),e.jsx(D,{value:"CDS",children:"CDS"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Product"}),e.jsxs(Z,{value:$e,onValueChange:He,children:[e.jsx(K,{children:e.jsx(J,{})}),e.jsxs(ee,{children:[e.jsx(D,{value:"NRML",children:"NRML"}),e.jsx(D,{value:"MIS",children:"MIS"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Qty"}),e.jsx(P,{placeholder:"Qty",value:Ye,onChange:s=>Ge(s.target.value),type:"number"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Side"}),e.jsxs(Z,{value:qe,onValueChange:s=>Be(s),children:[e.jsx(K,{children:e.jsx(J,{})}),e.jsxs(ee,{children:[e.jsx(D,{value:"SELL",children:"SELL"}),e.jsx(D,{value:"BUY",children:"BUY"})]})]})]})]}),e.jsxs("div",{className:"rounded-md border p-4 space-y-3 bg-muted/20",children:[e.jsx(v,{className:"font-medium text-xs uppercase text-muted-foreground",children:"Execution Condition"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{className:"text-xs",children:"Wait Trigger %"}),e.jsx(P,{placeholder:"Immediate if empty",value:Ne,onChange:s=>Xe(s.target.value),type:"number",step:"0.1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{className:"text-xs",children:"Baseline Price"}),e.jsx(P,{placeholder:"Required for wait",value:ye,onChange:s=>ze(s.target.value),type:"number"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-2 border-t",children:[e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"manual-reentry-limit",children:"Re-entry Limit"}),e.jsx(P,{id:"manual-reentry-limit",type:"number",placeholder:"e.g. 1",min:"0",step:"1",value:pe,onChange:s=>Me(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"manual-reexecute-limit",children:"Re-exec Limit"}),e.jsx(P,{id:"manual-reexecute-limit",type:"number",placeholder:"e.g. 1",min:"0",step:"1",value:ge,onChange:s=>Fe(s.target.value)})]})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"manual-leg-name",children:"Leg Pair Name"}),e.jsx(P,{id:"manual-leg-name",placeholder:"Hedge Pair",value:d,onChange:s=>N(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-6",children:[e.jsx(hs,{checked:y,onCheckedChange:re,id:"manual-is-main-leg"}),e.jsx(v,{htmlFor:"manual-is-main-leg",children:"Main Leg"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"manual-sl-percent",children:"SL Percent"}),e.jsx(P,{id:"manual-sl-percent",placeholder:"0.05",value:ue,onChange:s=>De(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"manual-target-percent",children:"Target Percent"}),e.jsx(P,{id:"manual-target-percent",placeholder:"0.1",value:he,onChange:s=>Re(s.target.value)})]})]})]})]}),e.jsxs(xs,{children:[e.jsx(A,{variant:"ghost",onClick:()=>I(!1),children:"Cancel"}),e.jsx(A,{onClick:ws,disabled:Ae||ie==="TRACK"&&(R||O.length===0),children:Ae?"Adding...":"Add Position"})]})]})}),e.jsx(Ps,{open:H.open,onOpenChange:s=>{W||(_e(n=>({...n,open:s})),s||ce(""))},children:e.jsxs(Cs,{children:[e.jsxs(Ds,{children:[e.jsx(Rs,{children:"Delete Strategy State?"}),e.jsx(Ms,{asChild:!0,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{children:["Are you sure you want to delete the strategy state for"," ",e.jsx("strong",{children:H.strategyName}),"? This action cannot be undone and will remove all position data and trade history for this strategy."]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm",children:["To confirm, type ",e.jsx("strong",{className:"text-foreground",children:H.strategyName})," below:"]}),e.jsx("input",{type:"text",value:Je,onChange:s=>ce(s.target.value),placeholder:"Type strategy name to confirm",className:"w-full px-3 py-2 text-sm border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring",disabled:W,autoComplete:"off"})]})]})})]}),e.jsxs(Fs,{children:[e.jsx(As,{disabled:W,children:"Cancel"}),e.jsx(Os,{onClick:_s,disabled:W||!vs,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 disabled:opacity-50",children:W?"Deleting...":"Delete"})]})]})}),e.jsx(is,{open:w.open,onOpenChange:s=>{B||(oe(n=>({...n,open:s})),s||(de(""),be("SL_HIT")))},children:e.jsxs(ls,{children:[e.jsxs(cs,{children:[e.jsx(os,{children:"Exit Position"}),e.jsxs(ds,{children:["Manually exit position for ",w.leg?.symbol," (",w.leg?.side," ",w.leg?.quantity,")"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"exit-price",children:"Exit Price *"}),e.jsx(P,{id:"exit-price",type:"number",step:"0.05",placeholder:"Enter exit price",value:ve,onChange:s=>de(s.target.value),disabled:B}),w.leg?.entry_price&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Entry Price: ",L(w.leg.entry_price)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"exit-status",children:"Exit Status *"}),e.jsxs(Z,{value:xe,onValueChange:s=>be(s),disabled:B,children:[e.jsx(K,{id:"exit-status",children:e.jsx(J,{})}),e.jsxs(ee,{children:[e.jsx(D,{value:"SL_HIT",children:"SL Hit"}),e.jsx(D,{value:"TARGET_HIT",children:"Target Hit"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select the exit reason for this position"})]})]}),e.jsxs(xs,{children:[e.jsx(A,{variant:"ghost",onClick:()=>oe({open:!1,instanceId:"",legKey:"",leg:null}),disabled:B,children:"Cancel"}),e.jsx(A,{onClick:Es,disabled:B||!ve,children:B?"Exiting...":"Exit Position"})]})]})})]})}export{It as default};
