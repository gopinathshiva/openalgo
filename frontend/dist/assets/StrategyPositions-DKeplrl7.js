import{r as l,j as e,a as xs}from"./vendor-react-CCyQGCED.js";import{w as oe,d as Fs,B as A,t as j,e as M}from"./index-CgAEGaTW.js";import{A as As,b as Os,c as ks,d as Us,e as $s,f as Ys,g as Hs,h as qs}from"./alert-dialog-Dddn6p-P.js";import{C as vs,d as Es,a as Bs,b as Gs}from"./card-Btw7S6dl.js";import{D as ms,b as us,c as hs,d as ps,e as gs,f as js}from"./dialog-BY1mJGno.js";import{S as te,a as ae,b as ne,c as re,d as R}from"./select-CCKOsaTe.js";import{C as Te,b as we,a as Le}from"./collapsible-DcfHjv7p.js";import{T as Xs,a as zs,b as fs,c as Ns}from"./tabs-CA6AnyaR.js";import{S as Pe}from"./switch-BRyclYh_.js";import{L as v}from"./label-gaeQLFtf.js";import{I as C}from"./input-B5i9Onv3.js";import{C as Ws}from"./checkbox-BPhZwPM4.js";import{T as ie,a as le,b as F,c as o,d as ce,e as d}from"./table-CoxW74BF.js";import{t as Qs}from"./trading-D8knBs9T.js";import{u as Vs}from"./useLivePrice-BpW9g-hp.js";import{_ as ys,a3 as Ce,o as De,ao as Ks,c as Zs,a4 as Js,b1 as Re}from"./vendor-icons-Dyz2WLZ8.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-Dzc1xxhr.js";import"./vendor-radix-CYVJEJRR.js";import"./useMarketData-DRthc1Gd.js";import"./useMarketStatus-CLA0_KMK.js";async function et(){const t=await oe.get("/api/strategy-state");if(t.data.status==="error")throw new Error(t.data.message||"Failed to fetch strategy states");return t.data.data}async function st(t){const r=await oe.delete(`/api/strategy-state/${encodeURIComponent(t)}`);if(r.data.status==="error")throw new Error(r.data.message||"Failed to delete strategy state")}async function tt(t,r,x,m){const f=await oe.post(`/api/strategy-state/${encodeURIComponent(t)}/override`,{leg_key:r,override_type:x,new_value:m});if(f.data.status==="error")throw new Error(f.data.message||"Failed to create strategy override");return{message:f.data.message||"Override created successfully"}}async function at(t,r){try{const x=await oe.post(`/api/strategy-state/${encodeURIComponent(t)}/manual-leg`,r);if(x.data.status==="error")throw new Error(x.data.message||"Failed to add manual position");return{message:x.data.message||"Manual position added successfully"}}catch(x){if(x&&typeof x=="object"&&"response"in x){const f=x.response?.data?.message;if(f)throw new Error(f)}throw x}}async function nt(t,r,x,m,f=!1){try{const N={};if(f)N.exit_at_market=!0,m&&(N.exit_status=m);else{if(!m)throw new Error("Exit status is required for manual price exits");N.exit_status=m,x!==null&&(N.exit_price=x)}const E=await oe.post(`/api/strategy-state/${encodeURIComponent(t)}/leg/${encodeURIComponent(r)}/manual-exit`,N);if(E.data.status==="error")throw new Error(E.data.message||"Failed to exit position");return{message:E.data.message||"Position exited successfully"}}catch(N){if(N&&typeof N=="object"&&"response"in N){const S=N.response?.data?.message;if(S)throw new Error(S)}throw N}}const rt={RUNNING:"bg-green-500",PAUSED:"bg-yellow-500",COMPLETED:"bg-gray-400",ERROR:"bg-red-500"},je={IDLE:"bg-gray-400",PENDING_ENTRY:"bg-blue-400",IN_POSITION:"bg-green-500",PENDING_EXIT:"bg-orange-400",EXITED_WAITING_REENTRY:"bg-yellow-500",EXITED_WAITING_REEXECUTE:"bg-purple-500",DONE:"bg-gray-500"},it={SL_HIT:"bg-red-500",TARGET_HIT:"bg-green-500",HEDGE_SL_EXIT:"bg-red-400",HEDGE_TARGET_EXIT:"bg-green-400",STRATEGY_DONE:"bg-gray-500"};function lt(t){if(t==null)return"â€”";const r=new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2,maximumFractionDigits:2}).format(Math.abs(t));return t<0?`-${r}`:r}function P(t){return t==null?"â€”":t.toFixed(2)}function ct(t){if(t.wait_trigger_price)return t.wait_trigger_price;const r=t.wait_baseline_price,x=t.wait_trade_percent;return r==null||x==null||!t.side?null:t.side==="BUY"?r*(1+x):t.side==="SELL"?r*(1-x):null}function ot(t){return t?new Date(t).toLocaleString("en-IN",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kolkata"}):"â€”"}function Me(t){if(!t)return"â€”";const r=new Date(t),x=new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),m=new Date(x.getFullYear(),x.getMonth(),x.getDate()),f=new Date(r.toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),N=new Date(f.getFullYear(),f.getMonth(),f.getDate());return m.getTime()===N.getTime()?r.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kolkata"}):r.toLocaleString("en-IN",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kolkata"})}function k({value:t,showIcon:r=!0}){if(t==null)return e.jsx("span",{className:"text-muted-foreground",children:"-"});const x=t>=0,m=x?"text-green-600":"text-red-600";return e.jsxs("span",{className:`font-medium ${m} flex items-center gap-1`,children:[r&&(x?e.jsx(Zs,{className:"h-3 w-3"}):e.jsx(Js,{className:"h-3 w-3"})),lt(t)]})}function Fe(t,r){const x=t.entry_price,m=t.quantity,f=t.side;return r==null||x==null||m===null||m===void 0||!f?null:f==="BUY"?(r-x)*m:f==="SELL"?(x-r)*m:null}function dt(t){return!t||t.length===0?0:t.reduce((r,x)=>r+(x.pnl||0),0)}function _s({value:t,instanceId:r,legKey:x,overrideType:m,leg:f,onSuccess:N}){const[E,S]=l.useState(!1),[I,h]=l.useState(""),[n,D]=l.useState(!1),O=xs.useRef(null),c=f.status==="IN_POSITION",H=()=>{c&&(h(t?.toString()??""),S(!0))};xs.useEffect(()=>{E&&O.current&&(O.current.focus(),O.current.select())},[E]);const U=i=>{if(Number.isNaN(i)||i<0)return"Value must be a non-negative number";const u=f.entry_price;if(!u)return null;const y=f.side;if(m==="sl_price"){if(y==="SELL"&&i<=u)return`SL for SELL must be above entry price (${u.toFixed(2)})`;if(y==="BUY"&&i>=u)return`SL for BUY must be below entry price (${u.toFixed(2)})`}if(m==="target_price"){if(y==="SELL"&&i>=u)return`Target for SELL must be below entry price (${u.toFixed(2)})`;if(y==="BUY"&&i<=u)return`Target for BUY must be above entry price (${u.toFixed(2)})`}return null},$=async()=>{const i=Number.parseFloat(I),u=U(i);if(u){j.error(u);return}if(t!=null&&Math.abs(i-t)<.01){S(!1);return}D(!0);try{const y=await tt(r,x,m,i);j.success(y.message),S(!1),N()}catch(y){j.error(y instanceof Error?y.message:"Failed to update")}finally{D(!1)}},q=i=>{i.key==="Enter"?(i.preventDefault(),$()):i.key==="Escape"&&S(!1)},B=()=>{S(!1)};return E?e.jsx(C,{ref:O,type:"number",step:"0.05",value:I,onChange:i=>h(i.target.value),onKeyDown:q,onBlur:B,disabled:n,className:"h-7 w-20 text-right text-sm px-1"}):e.jsx("span",{onClick:H,onKeyDown:i=>i.key==="Enter"&&H(),tabIndex:c?0:void 0,role:c?"button":void 0,className:c?"cursor-pointer hover:bg-muted px-1 py-0.5 rounded transition-colors":"",title:c?"Click to edit":void 0,children:P(t)})}function xt({legs:t,instanceId:r,onRefresh:x,liveLtpByLegKey:m,onExitLeg:f}){if(!t)return e.jsx("p",{className:"text-muted-foreground text-sm py-4",children:"No positions found"});const N=Object.entries(t),E=N.filter(([h,n])=>["IN_POSITION","PENDING_EXIT"].includes(n.status)),S=N.filter(([h,n])=>["IDLE","PENDING_ENTRY","EXITED_WAITING_REENTRY","EXITED_WAITING_REEXECUTE"].includes(n.status)),I=N.filter(([h,n])=>n.status==="DONE");return N.length===0?e.jsx("p",{className:"text-muted-foreground text-sm py-4",children:"No positions found"}):e.jsxs("div",{className:"space-y-4",children:[E.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4 text-green-500"}),"Open Positions (",E.length,")"]}),e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(ie,{children:[e.jsx(le,{children:e.jsxs(F,{children:[e.jsx(o,{children:"Leg"}),e.jsx(o,{children:"Symbol"}),e.jsx(o,{children:"Side"}),e.jsx(o,{className:"text-right",children:"Qty"}),e.jsx(o,{className:"text-right",children:"Entry"}),e.jsx(o,{className:"text-right",children:"LTP"}),e.jsx(o,{className:"text-right",children:"SL"}),e.jsx(o,{className:"text-right",children:"Target"}),e.jsx(o,{children:"Status"}),e.jsx(o,{className:"text-right",children:"Unreal P&L"}),e.jsx(o,{className:"text-right",children:"Reentry"}),e.jsx(o,{className:"text-center",children:"Action"})]})}),e.jsx(ce,{children:E.map(([h,n])=>e.jsxs(F,{children:[e.jsx(d,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:n.leg_pair_name||h}),n.is_main_leg&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Main"})]})}),e.jsx(d,{className:"font-mono text-xs",children:n.symbol}),e.jsx(d,{children:n.side?e.jsx(M,{variant:n.side==="SELL"?"destructive":"default",children:n.side}):e.jsx("span",{className:"text-muted-foreground",children:"â€”"})}),e.jsx(d,{className:"text-right",children:n.quantity}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:P(n.entry_price)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Me(n.entry_time)})]})}),e.jsx(d,{className:"text-right",children:m?.[h]===null||m?.[h]===void 0?"-":P(m?.[h])}),e.jsx(d,{className:"text-right",children:e.jsx(_s,{value:n.sl_price,instanceId:r,legKey:h,overrideType:"sl_price",leg:n,onSuccess:x})}),e.jsx(d,{className:"text-right",children:e.jsx(_s,{value:n.target_price,instanceId:r,legKey:h,overrideType:"target_price",leg:n,onSuccess:x})}),e.jsx(d,{children:e.jsx(M,{className:je[n.status],variant:"secondary",children:n.status.replace(/_/g," ")})}),e.jsx(d,{className:"text-right",children:e.jsx(k,{value:Fe(n,m?.[h])})}),e.jsx(d,{className:"text-right",children:n.reentry_limit===null||n.reentry_limit===void 0?"-":`${n.reentry_count??0}/${n.reentry_limit}`}),e.jsx(d,{className:"text-center",children:n.status==="IN_POSITION"&&e.jsx(A,{variant:"outline",size:"sm",onClick:()=>f(h,n),className:"h-7 px-2 text-xs",children:"Exit"})})]},h))})]})})]}),S.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4 text-yellow-500"}),"Pending / Planned Trades (",S.length,")"]}),e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(ie,{children:[e.jsx(le,{children:e.jsxs(F,{children:[e.jsx(o,{children:"Leg"}),e.jsx(o,{children:"Symbol"}),e.jsx(o,{children:"Side"}),e.jsx(o,{className:"text-right",children:"Qty"}),e.jsx(o,{className:"text-right",children:"LTP"}),e.jsx(o,{className:"text-right",children:"Planned Entry"}),e.jsx(o,{className:"text-right",children:"Planned SL"}),e.jsx(o,{className:"text-right",children:"Planned Target"}),e.jsx(o,{children:"Status"}),e.jsx(o,{className:"text-right",children:"Reentry"}),e.jsx(o,{className:"text-right",children:"Reexec"})]})}),e.jsx(ce,{children:S.map(([h,n])=>e.jsxs(F,{children:[e.jsx(d,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:n.leg_pair_name||h}),n.is_main_leg&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Main"})]})}),e.jsx(d,{className:"font-mono text-xs",children:n.symbol}),e.jsx(d,{children:n.side?e.jsx(M,{variant:n.side==="SELL"?"destructive":"default",children:n.side}):e.jsx("span",{className:"text-muted-foreground",children:"â€”"})}),e.jsx(d,{className:"text-right",children:n.quantity}),e.jsx(d,{className:"text-right",children:m?.[h]===null||m?.[h]===void 0?"-":P(m?.[h])}),e.jsx(d,{className:"text-right",children:P(ct(n))}),e.jsx(d,{className:"text-right",children:P(n.sl_price)}),e.jsx(d,{className:"text-right",children:P(n.target_price)}),e.jsx(d,{children:e.jsx(M,{className:je[n.status]||"bg-gray-400",variant:"secondary",children:n.status.replace(/_/g," ")})}),e.jsx(d,{className:"text-right",children:n.reentry_limit===null||n.reentry_limit===void 0?"-":`${n.reentry_count??0}/${n.reentry_limit}`}),e.jsx(d,{className:"text-right",children:n.reexecute_limit===null||n.reexecute_limit===void 0?"-":`${n.reexecute_count??0}/${n.reexecute_limit}`})]},h))})]})})]}),I.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4 text-gray-500"}),"Done Legs (",I.length,")"]}),e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(ie,{children:[e.jsx(le,{children:e.jsxs(F,{children:[e.jsx(o,{children:"Leg"}),e.jsx(o,{children:"Symbol"}),e.jsx(o,{children:"Side"}),e.jsx(o,{className:"text-right",children:"Qty"}),e.jsx(o,{className:"text-right",children:"Total P&L"}),e.jsx(o,{children:"Status"})]})}),e.jsx(ce,{children:I.map(([h,n])=>e.jsxs(F,{children:[e.jsx(d,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:n.leg_pair_name||h}),n.is_main_leg&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Main"})]})}),e.jsx(d,{className:"font-mono text-xs",children:n.symbol}),e.jsx(d,{children:n.side?e.jsx(M,{variant:n.side==="SELL"?"destructive":"default",children:n.side}):e.jsx("span",{className:"text-muted-foreground",children:"â€”"})}),e.jsx(d,{className:"text-right",children:n.quantity}),e.jsx(d,{className:"text-right",children:e.jsx("div",{className:"flex justify-end",children:e.jsx(k,{value:n.total_pnl??n.realized_pnl})})}),e.jsx(d,{children:e.jsx(M,{className:je[n.status]||"bg-gray-400",variant:"secondary",children:n.status.replace(/_/g," ")})})]},h))})]})})]})]})}function mt({trades:t}){return!t||t.length===0?e.jsx("p",{className:"text-muted-foreground text-sm py-4",children:"No trade history"}):e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsx("div",{className:"max-h-[50vh] overflow-y-auto",children:e.jsxs(ie,{children:[e.jsx(le,{children:e.jsxs(F,{children:[e.jsx(o,{children:"#"}),e.jsx(o,{children:"Leg"}),e.jsx(o,{children:"Symbol"}),e.jsx(o,{children:"Side"}),e.jsx(o,{className:"text-right",children:"Qty"}),e.jsx(o,{className:"text-right",children:"Entry"}),e.jsx(o,{className:"text-right",children:"Exit"}),e.jsx(o,{className:"text-right",children:"SL"}),e.jsx(o,{className:"text-right",children:"Target"}),e.jsx(o,{children:"Exit Type"}),e.jsx(o,{className:"text-right",children:"P&L"})]})}),e.jsx(ce,{children:t.map(r=>e.jsxs(F,{children:[e.jsx(d,{children:r.trade_id}),e.jsx(d,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:r.leg_pair_name||r.leg_key}),r.is_main_leg&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Main"})]})}),e.jsx(d,{className:"font-mono text-xs",children:r.symbol}),e.jsx(d,{children:e.jsx(M,{variant:r.side==="SELL"?"destructive":"default",children:r.side})}),e.jsx(d,{className:"text-right",children:r.quantity}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:P(r.entry_price)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Me(r.entry_time)})]})}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:P(r.exit_price)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Me(r.exit_time)})]})}),e.jsx(d,{className:"text-right",children:P(r.sl_price)}),e.jsx(d,{className:"text-right",children:P(r.target_price)}),e.jsx(d,{children:r.exit_type&&e.jsx(M,{className:it[r.exit_type],variant:"secondary",children:r.exit_type.replace(/_/g," ")})}),e.jsx(d,{className:"text-right",children:e.jsx(k,{value:r.pnl})})]},r.trade_id))})]})})})}function ut({strategy:t,onDelete:r,onRefresh:x,liveLtpByLegKey:m,onAddManualLeg:f,onExitLeg:N,expandAll:E}){const[S,I]=l.useState(E),[h,n]=l.useState(!1),[D,O]=l.useState(!1),c=t.config;l.useEffect(()=>{I(E)},[E]);const H=i=>{i.stopPropagation(),r(t.instance_id,t.strategy_name)},U=t.legs||{},$=l.useMemo(()=>dt(t.trade_history),[t.trade_history]),q=l.useMemo(()=>{let i=0;for(const[u,y]of Object.entries(U)){if(!["IN_POSITION","PENDING_EXIT"].includes(y.status))continue;const G=Fe(y,m?.[u]);G!==null&&(i+=G)}return i},[U,m]),B=$+q;return e.jsx(Te,{open:S,onOpenChange:I,children:e.jsxs(vs,{className:"mb-4",children:[e.jsx(we,{asChild:!0,children:e.jsx(Bs,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[S?e.jsx(Ce,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(De,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx(Gs,{className:"text-lg",children:t.strategy_name}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[c&&e.jsxs(e.Fragment,{children:[c.underlying," | Expiry: ",c.expiry_date," | Lots: ",c.lots," Ã— ",c.lot_size]}),!c&&`Instance: ${t.instance_id}`]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total P&L"}),e.jsx(k,{value:B})]}),e.jsx(M,{className:rt[t.status]||"bg-gray-400",children:t.status}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{variant:"outline",size:"sm",disabled:t.status==="COMPLETED",onClick:i=>{i.stopPropagation(),f(t)},title:t.status==="COMPLETED"?"Cannot add positions to completed strategies":"Add a manual position",children:"Add Position"}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:H,title:"Delete strategy state",children:e.jsx(Ks,{className:"h-4 w-4"})})]})]})]})})}),e.jsx(Le,{children:e.jsxs(Es,{className:"pt-0 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Open Positions"}),e.jsx("p",{className:"text-lg font-semibold",children:Object.values(t.legs||{}).filter(i=>["IN_POSITION","PENDING_EXIT"].includes(i.status)).length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pending / Planned"}),e.jsx("p",{className:"text-lg font-semibold",children:Object.values(t.legs||{}).filter(i=>["IDLE","PENDING_ENTRY","EXITED_WAITING_REENTRY","EXITED_WAITING_REEXECUTE"].includes(i.status)).length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Trades"}),e.jsx("p",{className:"text-lg font-semibold",children:t.trade_history?.length??0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Realized P&L"}),e.jsx(k,{value:$,showIcon:!1})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Unrealized P&L"}),e.jsx(k,{value:q,showIcon:!1})]})]}),c&&e.jsxs(Te,{open:D,onOpenChange:O,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-md font-semibold",children:"Strategy Configuration"}),e.jsx(we,{asChild:!0,children:e.jsxs(A,{variant:"ghost",size:"sm",className:"h-8 px-2",children:[D?e.jsx(Ce,{className:"h-4 w-4 mr-2"}):e.jsx(De,{className:"h-4 w-4 mr-2"}),D?"Hide":"Show"]})})]}),e.jsx(Le,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 text-sm border rounded-md p-4 bg-muted/20",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-semibold text-xs uppercase text-muted-foreground",children:"Basic Settings"}),c.underlying&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Underlying:"})," ",e.jsx("span",{className:"font-medium",children:c.underlying})]}),c.expiry_date&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Expiry:"})," ",e.jsx("span",{className:"font-medium",children:c.expiry_date})]}),c.lots!==void 0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Lots:"})," ",e.jsx("span",{className:"font-medium",children:c.lots})]}),c.lot_size!==void 0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Lot Size:"})," ",e.jsx("span",{className:"font-medium",children:c.lot_size})]}),c.quantity!==void 0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Quantity:"})," ",e.jsx("span",{className:"font-medium",children:c.quantity})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-semibold text-xs uppercase text-muted-foreground",children:"Execution"}),c.exchange&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Exchange:"})," ",e.jsx("span",{className:"font-medium",children:c.exchange})]}),c.product&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Product:"})," ",e.jsx("span",{className:"font-medium",children:c.product})]}),c.price_type&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Price Type:"})," ",e.jsx("span",{className:"font-medium",children:c.price_type})]}),c.poll_interval!==void 0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Poll Interval:"})," ",e.jsxs("span",{className:"font-medium",children:[c.poll_interval,"s"]})]}),c.entry_time&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Entry Time:"})," ",e.jsx("span",{className:"font-medium",children:c.entry_time})]}),c.exit_time&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Exit Time:"})," ",e.jsx("span",{className:"font-medium",children:c.exit_time})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-semibold text-xs uppercase text-muted-foreground",children:"Risk Management"}),c.sl_percent!==void 0&&c.sl_percent!==null&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"SL %:"})," ",e.jsxs("span",{className:"font-medium",children:[(c.sl_percent*100).toFixed(1),"%"]})]}),c.target_percent!==void 0&&c.target_percent!==null&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Target %:"})," ",e.jsxs("span",{className:"font-medium",children:[(c.target_percent*100).toFixed(1),"%"]})]}),c.reentry_limit!==void 0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Re-entry Limit:"})," ",e.jsx("span",{className:"font-medium",children:c.reentry_limit})]}),c.reexecute_limit!==void 0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Re-execute Limit:"})," ",e.jsx("span",{className:"font-medium",children:c.reexecute_limit})]})]}),c.leg_pair_configs&&c.leg_pair_configs.length>0&&e.jsxs("div",{className:"space-y-2 md:col-span-2 lg:col-span-3",children:[e.jsx("p",{className:"font-semibold text-xs uppercase text-muted-foreground",children:"Leg Configurations"}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:c.leg_pair_configs.map((i,u)=>e.jsxs("div",{className:"border rounded p-3 bg-background/50",children:[e.jsx("p",{className:"font-medium mb-2",children:i.name||`Leg ${u+1}`}),e.jsxs("div",{className:"space-y-1 text-xs",children:[i.main_leg&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Main Leg:"})," ",e.jsx("span",{className:"font-medium",children:i.main_leg})]}),i.sl_percent!==void 0&&i.sl_percent!==null&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"SL %:"})," ",e.jsxs("span",{className:"font-medium",children:[(i.sl_percent*100).toFixed(1),"%"]})]}),i.target_percent!==void 0&&i.target_percent!==null&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Target %:"})," ",e.jsxs("span",{className:"font-medium",children:[(i.target_percent*100).toFixed(1),"%"]})]}),i.reentry_limit!==void 0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Re-entry:"})," ",e.jsx("span",{className:"font-medium",children:i.reentry_limit})]}),i.reexecute_limit!==void 0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Re-execute:"})," ",e.jsx("span",{className:"font-medium",children:i.reexecute_limit})]}),i.ce_sell_offset&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"CE Sell:"})," ",e.jsx("span",{className:"font-medium",children:i.ce_sell_offset})]}),i.pe_sell_offset&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"PE Sell:"})," ",e.jsx("span",{className:"font-medium",children:i.pe_sell_offset})]})]})]},u))})]})]})})]}),e.jsxs(Te,{open:h,onOpenChange:n,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-md font-semibold",children:"Leg P&L"}),e.jsx(we,{asChild:!0,children:e.jsxs(A,{variant:"ghost",size:"sm",className:"h-8 px-2",children:[h?e.jsx(Ce,{className:"h-4 w-4 mr-2"}):e.jsx(De,{className:"h-4 w-4 mr-2"}),h?"Hide":"Show"]})})]}),e.jsx(Le,{children:e.jsx("div",{className:"rounded-md border overflow-x-auto mt-2",children:e.jsxs(ie,{children:[e.jsx(le,{children:e.jsxs(F,{children:[e.jsx(o,{children:"Leg"}),e.jsx(o,{children:"Symbol"}),e.jsx(o,{children:"Status"}),e.jsx(o,{className:"text-right",children:"Realized P&L"}),e.jsx(o,{className:"text-right",children:"Unrealized P&L"}),e.jsx(o,{className:"text-right",children:"Total P&L"})]})}),e.jsx(ce,{children:Object.entries(U).map(([i,u])=>{const y=["IN_POSITION","PENDING_EXIT"].includes(u.status)?Fe(u,m?.[i]):0,G=u.realized_pnl??0,Q=(u.total_pnl??null)!==null&&u.total_pnl!==void 0?u.total_pnl:y===null?null:G+y;return e.jsxs(F,{children:[e.jsx(d,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:u.leg_pair_name||i}),u.is_main_leg&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Main"})]})}),e.jsx(d,{className:"font-mono text-xs",children:u.symbol}),e.jsx(d,{children:e.jsx(M,{className:je[u.status]||"bg-gray-400",variant:"secondary",children:u.status.replace(/_/g," ")})}),e.jsx(d,{className:"text-right",children:e.jsx(k,{value:u.realized_pnl,showIcon:!1})}),e.jsx(d,{className:"text-right",children:e.jsx(k,{value:y,showIcon:!1})}),e.jsx(d,{className:"text-right",children:e.jsx(k,{value:Q,showIcon:!1})})]},i)})})]})})})]}),t.last_updated&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last updated: ",ot(t.last_updated),t.orchestrator&&` | Cycles: ${t.orchestrator.cycle_count}`]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold mb-3",children:"ðŸ“Š Current Positions"}),e.jsx(xt,{legs:t.legs,instanceId:t.instance_id,onRefresh:x,liveLtpByLegKey:m,onExitLeg:(i,u)=>N(t.instance_id,i,u)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold mb-3",children:"ðŸ“œ Trade History"}),e.jsx(mt,{trades:t.trade_history})]})]})})]})})}function Ft(){const[t,r]=l.useState([]),[x,m]=l.useState(!0),[f,N]=l.useState(!1),{apiKey:E}=Fs(),[S,I]=l.useState(!1),[h,n]=l.useState(null),[D,O]=l.useState([]),[c,H]=l.useState(!1),[U,$]=l.useState(null),[q,B]=l.useState(""),[i,u]=l.useState(""),[y,G]=l.useState(!0),[Q,Ae]=l.useState(""),[fe,Oe]=l.useState(""),[Ne,ke]=l.useState(""),[ye,Ue]=l.useState(""),[$e,_e]=l.useState(!1),[de,Ye]=l.useState("TRACK"),[ve,He]=l.useState(""),[qe,bs]=l.useState("NFO"),[Be,Ge]=l.useState("NRML"),[Xe,ze]=l.useState(""),[We,Qe]=l.useState("SELL"),[Ee,Ve]=l.useState(""),[be,Ke]=l.useState(""),Ze="strategy_positions_auto_refresh_enabled",Je="strategy_positions_auto_refresh_seconds",es="strategy_positions_expand_all",[z,ss]=l.useState(!0),[V,ts]=l.useState(10),[xe,as]=l.useState(!1),me=l.useRef(!1),[Y,Se]=l.useState({open:!1,instanceId:"",strategyName:""}),[K,ns]=l.useState(!1),[rs,ue]=l.useState(""),[w,he]=l.useState({open:!1,instanceId:"",legKey:"",leg:null}),[pe,ge]=l.useState(""),[Z,J]=l.useState("SL_HIT"),[L,Ie]=l.useState(!1),[X,is]=l.useState(!1),W=async(s=!1)=>{try{const a=await et();r(a),s&&j.success("Data refreshed")}catch(a){console.error("Error fetching strategy states:",a),j.error("Failed to fetch strategy positions")}finally{m(!1),N(!1),me.current=!1}},Ss=(s,a)=>{ue(""),Se({open:!0,instanceId:s,strategyName:a})},Is=async()=>{if(Y.instanceId){ns(!0);try{await st(Y.instanceId),j.success(`Strategy "${Y.strategyName}" deleted successfully`),r(s=>s.filter(a=>a.instance_id!==Y.instanceId))}catch(s){console.error("Error deleting strategy:",s),j.error("Failed to delete strategy")}finally{ns(!1),Se({open:!1,instanceId:"",strategyName:""}),ue("")}}},Ts=rs===Y.strategyName,ws=(s,a,g)=>{he({open:!0,instanceId:s,legKey:a,leg:g}),ge(""),J("SL_HIT"),Ie(!1)},Ls=s=>{Ie(s),J(s?null:"SL_HIT")},Ps=async()=>{if(!(!w.instanceId||!w.legKey||!w.leg)){if(!L){const s=parseFloat(pe);if(isNaN(s)||s<=0){j.error("Please enter a valid exit price");return}if(!Z){j.error("Please select an exit status");return}const a=w.leg.entry_price,g=w.leg.side;if(a&&g){if(Z==="TARGET_HIT"){if(g==="BUY"&&s<=a){j.error(`For BUY positions with TARGET_HIT, exit price must be greater than entry price (${a.toFixed(2)})`);return}if(g==="SELL"&&s>=a){j.error(`For SELL positions with TARGET_HIT, exit price must be less than entry price (${a.toFixed(2)})`);return}}else if(Z==="SL_HIT"){if(g==="BUY"&&s>=a){j.error(`For BUY positions with SL_HIT, exit price must be less than entry price (${a.toFixed(2)})`);return}if(g==="SELL"&&s<=a){j.error(`For SELL positions with SL_HIT, exit price must be greater than entry price (${a.toFixed(2)})`);return}}}}is(!0);try{const s=L?null:parseFloat(pe),a=await nt(w.instanceId,w.legKey,s,Z,L);j.success(a.message),he({open:!1,instanceId:"",legKey:"",leg:null}),ge(""),Ie(!1),await W(!1)}catch(s){console.error("Error exiting position:",s),j.error(s instanceof Error?s.message:"Failed to exit position")}finally{is(!1)}}};l.useEffect(()=>{try{const s=window.localStorage.getItem(Ze);s!==null&&ss(s==="1"||s==="true");const a=window.localStorage.getItem(Je);if(a){const T=Number.parseInt(a,10);if(!Number.isNaN(T)){const _=Math.min(300,Math.max(5,T));ts(_)}}const g=window.localStorage.getItem(es);g!==null&&as(g==="1")}catch(s){console.error("Error loading strategy positions auto-refresh preferences:",s)}W()},[]),l.useEffect(()=>{try{window.localStorage.setItem(Ze,z?"1":"0"),window.localStorage.setItem(Je,String(V))}catch(s){console.error("Error saving strategy positions auto-refresh preferences:",s)}},[z,V]),l.useEffect(()=>{try{window.localStorage.setItem(es,xe?"1":"0")}catch(s){console.error("Error saving strategy positions expand all preference:",s)}},[xe]),l.useEffect(()=>{if(!z)return;const s=Math.min(300,Math.max(5,V)),a=window.setInterval(()=>{me.current||(me.current=!0,N(!0),W(!1))},s*1e3);return()=>window.clearInterval(a)},[z,V]);const ls=l.useMemo(()=>{const s=[];for(const a of t){let g=a.config?.exchange||"NFO";if(!a.config?.exchange&&a.state_data){const _=a.state_data.underlying||a.config?.underlying;_==="SENSEX"||_==="BANKEX"||_==="SENSEX50"?g="BFO":(_==="NIFTY"||_==="BANKNIFTY"||_==="FINNIFTY"||_==="MIDCPNIFTY")&&(g="NFO")}const T=a.legs||{};for(const[_,p]of Object.entries(T)){if(!["IN_POSITION","PENDING_EXIT","PENDING_ENTRY","IDLE","EXITED_WAITING_REENTRY","EXITED_WAITING_REEXECUTE"].includes(p.status))continue;const b=(p.symbol||"").trim();if(b)if(b.includes(":")){const[ee,se]=b.split(":",2);if(!se)continue;s.push({instanceId:a.instance_id,legKey:_,symbol:se,exchange:ee||g,ltp:p.current_ltp??p.entry_price,quantity:p.quantity,average_price:p.entry_price??void 0})}else s.push({instanceId:a.instance_id,legKey:_,symbol:b,exchange:g,ltp:p.current_ltp??p.entry_price,quantity:p.quantity,average_price:p.entry_price??void 0})}}return s},[t]),{data:cs}=Vs(ls,{enabled:ls.length>0,useMultiQuotesFallback:!0,staleThreshold:5e3,multiQuotesRefreshInterval:3e4,pauseWhenHidden:!0}),Cs=l.useMemo(()=>{const s={};for(const a of cs)s[a.instanceId]||(s[a.instanceId]={}),s[a.instanceId][a.legKey]=a.ltp;return s},[cs]),Ds=()=>{me.current=!0,N(!0),W(!0)},os=()=>{O([]),B(""),u(""),G(!0),Ae(""),Oe(""),ke(""),Ue(""),$(null),_e(!1),Ye("TRACK"),He(""),ze(""),Ve(""),Ke(""),Qe("SELL"),Ge("NRML")},Rs=async s=>{if(!E){j.error("API key not available");return}n(s),I(!0),H(!0),$(null);try{const a=await Qs.getPositions(E);if(a.status!=="success"||!a.data)throw new Error(a.message||"Failed to load positions");const g=a.data.filter(T=>T.quantity!==0);O(g),g.length===0&&B("")}catch(a){$(a instanceof Error?a.message:"Failed to load positions")}finally{H(!1)}},Ms=async()=>{if(!h)return;const s=Q.trim()===""?null:Number.parseFloat(Q),a=fe.trim()===""?null:Number.parseFloat(fe),g=Ne.trim()===""?null:Number.parseInt(Ne,10),T=ye.trim()===""?null:Number.parseInt(ye,10);if(s!==null&&(Number.isNaN(s)||s<=0)){j.error("SL percent must be a positive number");return}if(a!==null&&(Number.isNaN(a)||a<=0)){j.error("Target percent must be a positive number");return}if(g!==null&&(Number.isNaN(g)||g<0)){j.error("Re-entry limit must be a non-negative number");return}if(T!==null&&(Number.isNaN(T)||T<0)){j.error("Re-execute limit must be a non-negative number");return}if(!y&&i.trim()){const p=i.trim(),b=h;if(!(b?.legs&&Object.values(b.legs).some(se=>se.leg_pair_name===p&&se.is_main_leg===!0))){j.error(`Leg Pair '${p}' must have at least one Main Leg trade. Please mark this as Main Leg or add a Main Leg trade first.`);return}}let _={leg_key:`MANUAL_${Date.now()}`,sl_percent:s,target_percent:a,leg_pair_name:i.trim()?i.trim():null,reentry_limit:g,reexecute_limit:T,mode:de};if(de==="TRACK"){const p=D.find(b=>`${b.exchange}:${b.symbol}:${b.product}:${b.quantity}`===q);if(!p){j.error("Select a position");return}_={..._,symbol:p.symbol,exchange:p.exchange,product:p.product,quantity:Math.abs(p.quantity),side:p.quantity>0?"BUY":"SELL",entry_price:p.average_price,is_main_leg:y}}else{if(!ve.trim()){j.error("Symbol is required");return}const p=parseInt(Xe);if(isNaN(p)||p<=0){j.error("Invalid quantity");return}const b=Ee.trim()?parseFloat(Ee):null,ee=be.trim()?parseFloat(be):null;if(b!==null&&(isNaN(b)||b<=0)){j.error("Invalid wait percentage");return}if(b!==null&&ee===null){j.error("Baseline price is required for Wait Entry");return}_={..._,symbol:ve.toUpperCase(),exchange:qe,product:Be,quantity:p,side:We,is_main_leg:y,wait_trade_percent:b,wait_baseline_price:ee}}_e(!0);try{const p=await at(h.instance_id,_);j.success(p.message),I(!1),os(),W(!1)}catch(p){j.error(p instanceof Error?p.message:"Failed to add manual position")}finally{_e(!1)}},ds=l.useMemo(()=>[...t].sort((s,a)=>{const g=(s.strategy_name||"").toLocaleLowerCase(),T=(a.strategy_name||"").toLocaleLowerCase();if(g<T)return-1;if(g>T)return 1;const _=s.created_at?new Date(s.created_at).getTime():Number.POSITIVE_INFINITY,p=a.created_at?new Date(a.created_at).getTime():Number.POSITIVE_INFINITY;return _!==p?_-p:(s.instance_id||"").localeCompare(a.instance_id||"")}),[t]);return e.jsxs("div",{className:"container mx-auto py-6 px-4 max-w-7xl",children:[e.jsx("div",{className:"sticky top-[56px] z-10 bg-background pb-6 mb-6 border-b",children:e.jsxs("div",{className:"flex items-start justify-between gap-4 pt-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Strategy Positions"}),e.jsx("p",{className:"text-muted-foreground",children:"View positions and trade history for Python strategies"})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"text-xs text-muted-foreground",children:"Expand all"}),e.jsx(Pe,{checked:xe,onCheckedChange:as})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"text-xs text-muted-foreground",children:"Auto refresh"}),e.jsx(Pe,{checked:z,onCheckedChange:ss})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"text-xs text-muted-foreground",children:"Every (s)"}),e.jsx(C,{type:"number",min:5,max:300,step:1,value:V,onChange:s=>{const a=Number.parseInt(s.target.value,10);if(Number.isNaN(a))return;const g=Math.min(300,Math.max(5,a));ts(g)},className:"h-8 w-20",disabled:!z})]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:Ds,disabled:f,children:[e.jsx(ys,{className:`h-4 w-4 mr-2 ${f?"animate-spin":""}`}),"Refresh"]})]}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Range: 5â€“300 seconds (saved locally)"})]})]})}),x?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ys,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):ds.length===0?e.jsx(vs,{children:e.jsxs(Es,{className:"py-12 text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:"No strategy states found"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Strategy positions will appear here when you run Python strategies with state persistence."})]})}):e.jsx("div",{children:ds.map(s=>e.jsx(ut,{strategy:s,onDelete:Ss,onRefresh:()=>W(!1),liveLtpByLegKey:Cs[s.instance_id]||{},onAddManualLeg:Rs,onExitLeg:ws,expandAll:xe},s.instance_id))}),e.jsx(ms,{open:S,onOpenChange:s=>{I(s),s||(os(),n(null))},children:e.jsxs(us,{className:"sm:max-w-xl",children:[e.jsxs(hs,{children:[e.jsx(ps,{children:"Add Position to Strategy"}),e.jsxs(gs,{children:["Select a live broker position to track in ",h?.strategy_name||"this strategy","."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Xs,{value:de,onValueChange:s=>Ye(s),children:[e.jsxs(zs,{className:"grid w-full grid-cols-2",children:[e.jsx(fs,{value:"TRACK",children:"Track Existing"}),e.jsx(fs,{value:"NEW",children:"New Trade"})]}),e.jsx(Ns,{value:"TRACK",className:"pt-4 space-y-4",children:c?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading positions..."}):U?e.jsx("p",{className:"text-sm text-destructive",children:U}):D.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No open positions available."}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Position"}),e.jsxs(te,{value:q,onValueChange:B,children:[e.jsx(ae,{children:e.jsx(ne,{placeholder:"Select position"})}),e.jsx(re,{children:D.map(s=>{const a=`${s.exchange}:${s.symbol}:${s.product}:${s.quantity}`,g=s.quantity>0?"BUY":"SELL";return e.jsxs(R,{value:a,children:[s.exchange,":",s.symbol," â€¢ ",g," ",Math.abs(s.quantity)," @ ",P(s.average_price)]},a)})})]})]})}),e.jsxs(Ns,{value:"NEW",className:"pt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Symbol"}),e.jsx(C,{placeholder:"e.g. SENSEX24FEB75000PE",value:ve,onChange:s=>He(s.target.value.toUpperCase())})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Exchange"}),e.jsxs(te,{value:qe,onValueChange:bs,children:[e.jsx(ae,{children:e.jsx(ne,{})}),e.jsxs(re,{children:[e.jsx(R,{value:"NFO",children:"NFO"}),e.jsx(R,{value:"BFO",children:"BFO"}),e.jsx(R,{value:"MCX",children:"MCX"}),e.jsx(R,{value:"CDS",children:"CDS"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Product"}),e.jsxs(te,{value:Be,onValueChange:Ge,children:[e.jsx(ae,{children:e.jsx(ne,{})}),e.jsxs(re,{children:[e.jsx(R,{value:"NRML",children:"NRML"}),e.jsx(R,{value:"MIS",children:"MIS"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Qty"}),e.jsx(C,{placeholder:"Qty",value:Xe,onChange:s=>ze(s.target.value),type:"number"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Side"}),e.jsxs(te,{value:We,onValueChange:s=>Qe(s),children:[e.jsx(ae,{children:e.jsx(ne,{})}),e.jsxs(re,{children:[e.jsx(R,{value:"SELL",children:"SELL"}),e.jsx(R,{value:"BUY",children:"BUY"})]})]})]})]}),e.jsxs("div",{className:"rounded-md border p-4 space-y-3 bg-muted/20",children:[e.jsx(v,{className:"font-medium text-xs uppercase text-muted-foreground",children:"Execution Condition"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{className:"text-xs",children:"Wait Trigger %"}),e.jsx(C,{placeholder:"Immediate if empty",value:Ee,onChange:s=>Ve(s.target.value),type:"number",step:"0.1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{className:"text-xs",children:"Baseline Price"}),e.jsx(C,{placeholder:"Required for wait",value:be,onChange:s=>Ke(s.target.value),type:"number"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-2 border-t",children:[e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"manual-reentry-limit",children:"Re-entry Limit"}),e.jsx(C,{id:"manual-reentry-limit",type:"number",placeholder:"e.g. 1",min:"0",step:"1",value:Ne,onChange:s=>ke(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"manual-reexecute-limit",children:"Re-exec Limit"}),e.jsx(C,{id:"manual-reexecute-limit",type:"number",placeholder:"e.g. 1",min:"0",step:"1",value:ye,onChange:s=>Ue(s.target.value)})]})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"manual-leg-name",children:"Leg Pair Name"}),e.jsx(C,{id:"manual-leg-name",placeholder:"Hedge Pair",value:i,onChange:s=>u(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-6",children:[e.jsx(Pe,{checked:y,onCheckedChange:G,id:"manual-is-main-leg"}),e.jsx(v,{htmlFor:"manual-is-main-leg",children:"Main Leg"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"manual-sl-percent",children:"SL Percent"}),e.jsx(C,{id:"manual-sl-percent",placeholder:"0.05",value:Q,onChange:s=>Ae(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"manual-target-percent",children:"Target Percent"}),e.jsx(C,{id:"manual-target-percent",placeholder:"0.1",value:fe,onChange:s=>Oe(s.target.value)})]})]})]})]}),e.jsxs(js,{children:[e.jsx(A,{variant:"ghost",onClick:()=>I(!1),children:"Cancel"}),e.jsx(A,{onClick:Ms,disabled:$e||de==="TRACK"&&(c||D.length===0),children:$e?"Adding...":"Add Position"})]})]})}),e.jsx(As,{open:Y.open,onOpenChange:s=>{K||(Se(a=>({...a,open:s})),s||ue(""))},children:e.jsxs(Os,{children:[e.jsxs(ks,{children:[e.jsx(Us,{children:"Delete Strategy State?"}),e.jsx($s,{asChild:!0,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{children:["Are you sure you want to delete the strategy state for"," ",e.jsx("strong",{children:Y.strategyName}),"? This action cannot be undone and will remove all position data and trade history for this strategy."]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm",children:["To confirm, type ",e.jsx("strong",{className:"text-foreground",children:Y.strategyName})," below:"]}),e.jsx("input",{type:"text",value:rs,onChange:s=>ue(s.target.value),placeholder:"Type strategy name to confirm",className:"w-full px-3 py-2 text-sm border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring",disabled:K,autoComplete:"off"})]})]})})]}),e.jsxs(Ys,{children:[e.jsx(Hs,{disabled:K,children:"Cancel"}),e.jsx(qs,{onClick:Is,disabled:K||!Ts,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 disabled:opacity-50",children:K?"Deleting...":"Delete"})]})]})}),e.jsx(ms,{open:w.open,onOpenChange:s=>{X||(he(a=>({...a,open:s})),s||(ge(""),J("SL_HIT")))},children:e.jsxs(us,{children:[e.jsxs(hs,{children:[e.jsx(ps,{children:"Exit Position"}),e.jsxs(gs,{children:["Exit position for ",w.leg?.symbol," (",w.leg?.side," ",w.leg?.quantity,")"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ws,{id:"exit-at-market",checked:L,onCheckedChange:Ls,disabled:X}),e.jsx(v,{htmlFor:"exit-at-market",className:"text-sm font-medium cursor-pointer",children:"Exit at market price"})]}),L&&e.jsxs("p",{className:"text-xs text-amber-600 dark:text-amber-400 flex items-start gap-1",children:[e.jsx("span",{className:"mt-0.5",children:"âš ï¸"}),e.jsx("span",{children:"A MARKET order will be placed to exit this position. The actual fill price will be used."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"exit-price",children:["Exit Price ",!L&&"*"]}),e.jsx(C,{id:"exit-price",type:"number",step:"0.05",placeholder:L?"Will use market price":"Enter exit price",value:pe,onChange:s=>ge(s.target.value),disabled:X||L}),w.leg?.entry_price&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Entry Price: ",P(w.leg.entry_price)]}),!L&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use this to mark positions exited outside OpenAlgo"})]}),!L&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"exit-status",children:"Exit Status *"}),e.jsxs(te,{value:Z||"SL_HIT",onValueChange:s=>J(s),disabled:X,children:[e.jsx(ae,{id:"exit-status",children:e.jsx(ne,{})}),e.jsxs(re,{children:[e.jsx(R,{value:"SL_HIT",children:"SL Hit"}),e.jsx(R,{value:"TARGET_HIT",children:"Target Hit"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select the exit reason for this position"})]}),L&&e.jsx("div",{className:"space-y-2",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Exit status will be marked as ",e.jsx("span",{className:"font-medium",children:"Manual Exit"})]})})]}),e.jsxs(js,{children:[e.jsx(A,{variant:"ghost",onClick:()=>he({open:!1,instanceId:"",legKey:"",leg:null}),disabled:X,children:"Cancel"}),e.jsx(A,{onClick:Ps,disabled:X||!L&&!pe,children:X?"Exiting...":L?"Exit at Market":"Exit Position"})]})]})})]})}export{Ft as default};
