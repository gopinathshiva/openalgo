import{r as u}from"./vendor-react-CCyQGCED.js";import{t as V}from"./trading-AXYQOqxv.js";import{u as T}from"./useMarketData-KPfjVStN.js";import{u as U}from"./useMarketStatus-CLA0_KMK.js";import{d as W,g as K}from"./index-Di0BWSxS.js";function Z(e,g={}){const{enabled:n=!0,staleThreshold:o=5e3,useMultiQuotesFallback:s=!0,multiQuotesRefreshInterval:i=3e4,pauseWhenHidden:r=!0}=g,{apiKey:p}=W(),{isMarketOpen:h,isAnyMarketOpen:P}=U(),{isVisible:M,wasHidden:Q,timeSinceHidden:S}=K(),m=P(),[k,H]=u.useState(new Map),w=u.useRef(Date.now()),I=u.useMemo(()=>e.map(t=>({symbol:t.symbol,exchange:t.exchange})),[e]),{data:L,isConnected:O,isPaused:_,isFallbackMode:R}=T({symbols:I,mode:"LTP",enabled:n&&e.length>0}),$=O&&m&&!_,d=u.useCallback(async()=>{if(!(!p||e.length===0||!s))try{const t=e.map(a=>({symbol:a.symbol,exchange:a.exchange})),f=await V.getMultiQuotes(p,t);if(f.status==="success"&&f.results){const a=new Map;f.results.forEach(l=>{const D=`${l.exchange}:${l.symbol}`;l.data&&a.set(D,l.data)}),H(a)}}catch{}},[p,e,s]);return u.useEffect(()=>{if(!n||e.length===0||!s||r&&!M)return;d(),w.current=Date.now();const t=setInterval(()=>{d(),w.current=Date.now()},i);return()=>clearInterval(t)},[n,e.length,s,d,i,r,M]),u.useEffect(()=>{!Q||!M||!s||!n||S>i&&(d(),w.current=Date.now())},[Q,M,S,i,s,n,d]),{data:u.useMemo(()=>e.map(t=>{const f=`${t.exchange}:${t.symbol}`,a=L.get(f),l=k.get(f),D=t.quantity!==void 0&&t.quantity!==null,y=t.quantity||0,b=t.average_price||0,E=h(t.exchange)&&a?.data?.ltp&&a.lastUpdate&&Date.now()-a.lastUpdate<o,z=!E&&l?.ltp;let c,v="rest";if(E&&a?.data?.ltp?(c=a.data.ltp,v="websocket"):z&&l?.ltp?(c=l.ltp,v="multiquotes"):(c=t.ltp,v="rest"),D&&y===0)return{...t,_dataSource:"rest"};let x=t.pnl||0,A=t.pnlpercent||0;const F=t.today_realized_pnl||0;if(c&&b>0){let q;y>0?q=(c-b)*y:q=(b-c)*Math.abs(y),x=F+q;const C=Math.abs(b*y);A=C>0?x/C*100:0}return{...t,ltp:c,pnl:x,pnlpercent:A,_dataSource:v}}),[e,L,k,h,o]),isLive:$,isConnected:O,isPaused:_,isFallbackMode:R,isAnyMarketOpen:m,multiQuotes:k,refreshMultiQuotes:d}}function tt(e,g){if(!g)return null;let n=0,o=0,s=0;e.forEach(r=>{n+=r.pnl||0;const p=r.average_price||0,h=r.quantity||0,P=r.ltp||p;o+=p*h,s+=P*h});const i=o>0?n/o*100:0;return{...g,totalholdingvalue:s,totalinvvalue:o,totalprofitandloss:n,totalpnlpercentage:i}}export{tt as c,Z as u};
