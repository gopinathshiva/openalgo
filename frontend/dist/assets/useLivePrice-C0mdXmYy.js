import{r as u}from"./vendor-react-CCyQGCED.js";import{t as V}from"./trading-CL0jyEHU.js";import{u as T,a as U}from"./useMarketStatus-GYY20VGe.js";import{d as W,g as K}from"./index-3Co4tP4H.js";function Y(e,g={}){const{enabled:n=!0,staleThreshold:o=5e3,useMultiQuotesFallback:s=!0,multiQuotesRefreshInterval:i=3e4,pauseWhenHidden:c=!0}=g,{apiKey:p}=W(),{isMarketOpen:f,isAnyMarketOpen:P}=T(),{isVisible:M,wasHidden:Q,timeSinceHidden:S}=K(),L=P(),[k,H]=u.useState(new Map),w=u.useRef(Date.now()),I=u.useMemo(()=>e.map(t=>({symbol:t.symbol,exchange:t.exchange})),[e]),{data:O,isConnected:_,isPaused:E,isFallbackMode:R}=U({symbols:I,mode:"LTP",enabled:n&&e.length>0}),$=_&&L&&!E,d=u.useCallback(async()=>{if(!(!p||e.length===0||!s))try{const t=e.map(a=>({symbol:a.symbol,exchange:a.exchange})),h=await V.getMultiQuotes(p,t);if(h.status==="success"&&h.results){const a=new Map;h.results.forEach(l=>{const D=`${l.exchange}:${l.symbol}`;l.data&&a.set(D,l.data)}),H(a)}}catch{}},[p,e,s]);return u.useEffect(()=>{if(!n||e.length===0||!s||c&&!M)return;d(),w.current=Date.now();const t=setInterval(()=>{d(),w.current=Date.now()},i);return()=>clearInterval(t)},[n,e.length,s,d,i,c,M]),u.useEffect(()=>{!Q||!M||!s||!n||S>i&&(d(),w.current=Date.now())},[Q,M,S,i,s,n,d]),{data:u.useMemo(()=>e.map(t=>{const h=`${t.exchange}:${t.symbol}`,a=O.get(h),l=k.get(h),D=t.quantity!==void 0&&t.quantity!==null,y=t.quantity||0,b=t.average_price||0,m=f(t.exchange)&&a?.data?.ltp&&a.lastUpdate&&Date.now()-a.lastUpdate<o,z=!m&&l?.ltp;let r,v="rest";if(m&&a?.data?.ltp?(r=a.data.ltp,v="websocket"):z&&l?.ltp?(r=l.ltp,v="multiquotes"):(r=t.ltp,v="rest"),D&&y===0)return{...t,_dataSource:"rest"};let x=t.pnl||0,A=t.pnlpercent||0;const F=t.today_realized_pnl||0;if(r&&b>0){let q;y>0?q=(r-b)*y:q=(b-r)*Math.abs(y),x=F+q;const C=Math.abs(b*y);A=C>0?x/C*100:0}return{...t,ltp:r,pnl:x,pnlpercent:A,_dataSource:v}}),[e,O,k,f,o]),isLive:$,isConnected:_,isPaused:E,isFallbackMode:R,isAnyMarketOpen:L,multiQuotes:k,refreshMultiQuotes:d}}function Z(e,g){if(!g)return null;let n=0,o=0,s=0;e.forEach(c=>{n+=c.pnl||0;const p=c.average_price||0,f=c.quantity||0,P=c.ltp||p;o+=p*f,s+=P*f});const i=o>0?n/o*100:0;return{...g,totalholdingvalue:s,totalinvvalue:o,totalprofitandloss:n,totalpnlpercentage:i}}export{Z as c,Y as u};
