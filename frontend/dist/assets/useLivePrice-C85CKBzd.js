import{r as u}from"./vendor-react--vsXx8_n.js";import{t as T}from"./trading-CTN8LL90.js";import{u as U,a as W}from"./useMarketStatus-DTbQpWMh.js";import{d as K,g as j}from"./index-Dipul1nB.js";function Z(e,y={}){const{enabled:n=!0,staleThreshold:c=5e3,useMultiQuotesFallback:s=!0,multiQuotesRefreshInterval:p=3e4,pauseWhenHidden:l=!0,pauseDelay:g=5e3}=y,{apiKey:i}=K(),{isMarketOpen:M,isAnyMarketOpen:H}=U(),{isVisible:b,wasHidden:Q,timeSinceHidden:S}=j(),L=H(),[k,I]=u.useState(new Map),D=u.useRef(Date.now()),R=u.useMemo(()=>e.map(t=>({symbol:t.symbol,exchange:t.exchange})),[e]),{data:O,isConnected:_,isPaused:E,isFallbackMode:$}=W({symbols:R,mode:"LTP",enabled:n&&e.length>0,pauseWhenHidden:l,pauseDelay:g}),z=_&&L&&!E,d=u.useCallback(async()=>{if(!(!i||e.length===0||!s))try{const t=e.map(a=>({symbol:a.symbol,exchange:a.exchange})),h=await T.getMultiQuotes(i,t);if(h.status==="success"&&h.results){const a=new Map;h.results.forEach(o=>{const w=`${o.exchange}:${o.symbol}`;o.data&&a.set(w,o.data)}),I(a)}}catch{}},[i,e,s]);return u.useEffect(()=>{if(!n||e.length===0||!s||l&&!b)return;d(),D.current=Date.now();const t=setInterval(()=>{d(),D.current=Date.now()},p);return()=>clearInterval(t)},[n,e.length,s,d,p,l,b]),u.useEffect(()=>{!Q||!b||!s||!n||S>p&&(d(),D.current=Date.now())},[Q,b,S,p,s,n,d]),{data:u.useMemo(()=>e.map(t=>{const h=`${t.exchange}:${t.symbol}`,a=O.get(h),o=k.get(h),w=t.quantity!==void 0&&t.quantity!==null,f=t.quantity||0,v=t.average_price||0,m=M(t.exchange)&&a?.data?.ltp&&a.lastUpdate&&Date.now()-a.lastUpdate<c,F=!m&&o?.ltp;let r,P="rest";if(m&&a?.data?.ltp?(r=a.data.ltp,P="websocket"):F&&o?.ltp?(r=o.ltp,P="multiquotes"):(r=t.ltp,P="rest"),w&&f===0)return{...t,_dataSource:"rest"};let x=t.pnl||0,A=t.pnlpercent||0;const V=t.today_realized_pnl||0;if(r&&v>0){let q;f>0?q=(r-v)*f:q=(v-r)*Math.abs(f),x=V+q;const C=Math.abs(v*f);A=C>0?x/C*100:0}return{...t,ltp:r,pnl:x,pnlpercent:A,_dataSource:P}}),[e,O,k,M,c]),isLive:z,isConnected:_,isPaused:E,isFallbackMode:$,isAnyMarketOpen:L,multiQuotes:k,refreshMultiQuotes:d}}function tt(e,y){if(!y)return null;let n=0,c=0,s=0;e.forEach(l=>{n+=l.pnl||0;const g=l.average_price||0,i=l.quantity||0,M=l.ltp||g;c+=g*i,s+=M*i});const p=c>0?n/c*100:0;return{...y,totalholdingvalue:s,totalinvvalue:c,totalprofitandloss:n,totalpnlpercentage:p}}export{tt as c,Z as u};
