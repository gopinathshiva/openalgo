import{r as u}from"./vendor-react--vsXx8_n.js";import{t as F}from"./trading-CIdchktE.js";import{a as T,u as U,b as W}from"./useMarketStatus-DWFRwrtR.js";import{d as K}from"./index-CjQQIyHN.js";function Y(e,y={}){const{enabled:n=!0,staleThreshold:r=5e3,useMultiQuotesFallback:s=!0,multiQuotesRefreshInterval:p=3e4,pauseWhenHidden:l=!0,pauseDelay:g=5e3}=y,{apiKey:i}=K(),{isMarketOpen:M,isAnyMarketOpen:H}=T(),{isVisible:b,wasHidden:Q,timeSinceHidden:S}=U(),L=H(),[k,I]=u.useState(new Map),D=u.useRef(Date.now()),R=u.useMemo(()=>e.map(t=>({symbol:t.symbol,exchange:t.exchange})),[e]),{data:O,isConnected:_,isPaused:E}=W({symbols:R,mode:"LTP",enabled:n&&e.length>0,pauseWhenHidden:l,pauseDelay:g}),$=_&&L&&!E,d=u.useCallback(async()=>{if(!(!i||e.length===0||!s))try{const t=e.map(a=>({symbol:a.symbol,exchange:a.exchange})),h=await F.getMultiQuotes(i,t);if(h.status==="success"&&h.results){const a=new Map;h.results.forEach(o=>{const w=`${o.exchange}:${o.symbol}`;o.data&&a.set(w,o.data)}),I(a)}}catch{}},[i,e,s]);return u.useEffect(()=>{if(!n||e.length===0||!s||l&&!b)return;d(),D.current=Date.now();const t=setInterval(()=>{d(),D.current=Date.now()},p);return()=>clearInterval(t)},[n,e.length,s,d,p,l,b]),u.useEffect(()=>{!Q||!b||!s||!n||S>p&&(d(),D.current=Date.now())},[Q,b,S,p,s,n,d]),{data:u.useMemo(()=>e.map(t=>{const h=`${t.exchange}:${t.symbol}`,a=O.get(h),o=k.get(h),w=t.quantity!==void 0&&t.quantity!==null,f=t.quantity||0,v=t.average_price||0,m=M(t.exchange)&&a?.data?.ltp&&a.lastUpdate&&Date.now()-a.lastUpdate<r,z=!m&&o?.ltp;let c,P="rest";if(m&&a?.data?.ltp?(c=a.data.ltp,P="websocket"):z&&o?.ltp?(c=o.ltp,P="multiquotes"):(c=t.ltp,P="rest"),w&&f===0)return{...t,_dataSource:"rest"};let x=t.pnl||0,A=t.pnlpercent||0;const V=t.today_realized_pnl||0;if(c&&v>0){let q;f>0?q=(c-v)*f:q=(v-c)*Math.abs(f),x=V+q;const C=Math.abs(v*f);A=C>0?x/C*100:0}return{...t,ltp:c,pnl:x,pnlpercent:A,_dataSource:P}}),[e,O,k,M,r]),isLive:$,isConnected:_,isPaused:E,isAnyMarketOpen:L,multiQuotes:k,refreshMultiQuotes:d}}function Z(e,y){if(!y)return null;let n=0,r=0,s=0;e.forEach(l=>{n+=l.pnl||0;const g=l.average_price||0,i=l.quantity||0,M=l.ltp||g;r+=g*i,s+=M*i});const p=r>0?n/r*100:0;return{...y,totalholdingvalue:s,totalinvvalue:r,totalprofitandloss:n,totalpnlpercentage:p}}export{Z as c,Y as u};
